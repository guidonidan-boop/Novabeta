<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nova (beta) - Analisi di Sostenibilit√† Digitale</title>
    <meta name="description" content="Un assistente AI per calcolare l'impatto ambientale, l'accessibilit√† e la sostenibilit√† economica dei contenuti digitali.">

    <style>
        /* Tailwind CSS v3.4.1 | MIT License | https://tailwindcss.com - Pre-compiled for production */
        *,:after,:before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}*,:after,:before{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / .5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji}body{margin:0;line-height:inherit}h1,h2,h3,h4,p{margin:0}a{color:inherit;text-decoration:inherit}button{cursor:pointer}button,input{font-family:inherit;font-size:100%;font-weight:inherit;line-height:inherit;color:inherit;margin:0;padding:0}button{text-transform:none}[type=file]{-webkit-appearance:button;background-color:initial;background-image:initial;text-transform:none}[type=file]:focus{outline:1px solid ButtonText;outline:1px auto -webkit-focus-ring-color}img{display:block;vertical-align:middle;max-width:100%;height:auto}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.sticky{position:sticky}.inset-0{top:0;right:0;bottom:0;left:0}.top-0{top:0}.top-4{top:4}.right-4{right:1rem}.z-10{z-index:10}.z-20{z-index:20}.z-50{z-index:50}.mx-auto{margin-left:auto;margin-right:auto}.mb-2{margin-bottom:.5rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.mt-1{margin-top:.25rem}.mt-12{margin-top:3rem}.mt-2{margin-top:.5rem}.mt-4{margin-top:1rem}.mt-6{margin-top:1.5rem}.mt-8{margin-top:2rem}.mr-2{margin-right:.5rem}.mr-4{margin-right:1rem}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-16{height:4rem}.h-20{height:5rem}.h-24{height:6rem}.h-4{height:1rem}.h-5{height:1.25rem}.h-6{height:1.5rem}.h-full{height:100%}.min-h-screen{min-height:100vh}.w-16{width:4rem}.w-20{width:5rem}.w-24{width:6rem}.w-4{width:1rem}.w-5{width:1.25rem}.w-6{width:1.5rem}.w-full{width:100%}.max-w-2xl{max-width:42rem}.max-w-4xl{max-width:56rem}.max-w-lg{max-width:32rem}.flex-1{flex:1 1 0%}.flex-grow{flex-grow:1}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.grid-cols-5{grid-template-columns:repeat(5,minmax(0,1fr))}.animate-spin{animation:spin 1s linear infinite}.cursor-pointer{cursor:pointer}.flex-col{flex-direction:column}.items-start{align-items:flex-start}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-2{gap:.5rem}.gap-3{gap:.75rem}.gap-4{gap:1rem}.gap-6{gap:1.5rem}.space-y-4>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.space-y-6>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1.5rem * var(--tw-space-y-reverse))}.space-y-8>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(2rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(2rem * var(--tw-space-y-reverse))}.overflow-y-auto{overflow-y:auto}.rounded-2xl{border-radius:1rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:.5rem}.rounded-md{border-radius:.375rem}.border-2{border-width:2px}.border-4{border-width:4px}.border{border-width:1px}.border-dashed{border-style:dashed}.border-t-transparent{border-top-color:transparent}.border-\[\#96E6B3\]{--tw-border-opacity:1;border-color:rgb(150 230 179 / var(--tw-border-opacity))}.border-red-500{--tw-border-opacity:1;border-color:rgb(239 68 68 / var(--tw-border-opacity))}.border-white\/20{border-color:rgb(255 255 255 / .2)}.border-white\/30{border-color:rgb(255 255 255 / .3)}.border-white\/40{border-color:rgb(255 255 255 / .4)}.bg-\[\#1F3B2C\]{--tw-bg-opacity:1;background-color:rgb(31 59 44 / var(--tw-bg-opacity))}.bg-\[\#2a4a3a\]\/50{background-color:rgb(42 74 58 / .5)}.bg-\[\#96E6B3\]{--tw-bg-opacity:1;background-color:rgb(150 230 179 / var(--tw-bg-opacity))}.bg-black\/70{background-color:rgb(0 0 0 / .7)}.bg-red-900\/50{background-color:rgb(127 29 29 / .5)}.bg-white\/10{background-color:rgb(255 255 255 / .1)}.bg-white\/5{background-color:rgb(255 255 255 / .05)}.bg-white\/20{background-color:rgb(255 255 255 / .2)}.p-2{padding:.5rem}.p-4{padding:1rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.py-3{padding-top:.75rem;padding-bottom:.75rem}.text-center{text-align:center}.text-left{text-align:left}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-5xl{font-size:3rem;line-height:1}.text-6xl{font-size:3.75rem;line-height:1}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:.75rem;line-height:1rem}.font-bold{font-weight:700}.font-light{font-weight:300}.font-medium{font-weight:500}.font-semibold{font-weight:600}.text-\[\#1F3B2C\]{--tw-text-opacity:1;color:rgb(31 59 44 / var(--tw-text-opacity))}.text-\[\#96E6B3\]{--tw-text-opacity:1;color:rgb(150 230 179 / var(--tw-text-opacity))}.text-red-300{--tw-text-opacity:1;color:rgb(252 165 165 / var(--tw-text-opacity))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity))}.text-white\/60{color:rgb(255 255 255 / .6)}.text-white\/70{color:rgb(255 255 255 / .7)}.text-white\/80{color:rgb(255 255 255 / .8)}.text-white\/90{color:rgb(255 255 255 / .9)}.opacity-0{opacity:0}.underline{text-decoration-line:underline}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-colors{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-opacity{transition-property:opacity;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.duration-300{transition-duration:.3s}.list-disc{list-style-type:disc}.list-inside{list-style-position:inside}.hover\:border-\[\#96E6B3\]:hover{--tw-border-opacity:1;border-color:rgb(150 230 179 / var(--tw-border-opacity))}.hover\:bg-white:hover{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity))}.hover\:bg-white\/5:hover{background-color:rgb(255 255 255 / .05)}.hover\:text-\[\#96E6B3\]:hover{--tw-text-opacity:1;color:rgb(150 230 179 / var(--tw-text-opacity))}.hover\:text-white:hover{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity))}.hover\:underline:hover{text-decoration-line:underline}.hover\:opacity-100:hover{opacity:1}@media(min-width:640px){.sm\:p-6{padding:1.5rem}.sm\:text-left{text-align:left}.sm\:flex-row{flex-direction:row}.sm\:items-center{align-items:center}.sm\:mt-0{margin-top:0}.sm\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.sm\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}}@media(min-width:768px){.md\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.md\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.md\:grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}}@media(min-width:1024px){.lg\:p-8{padding:2rem}.lg\:grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}.lg\:grid-cols-5{grid-template-columns:repeat(5,minmax(0,1fr))}}
        
        /* Custom styles */
        @keyframes spin { to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }
        .drag-active { border-color: #96E6B3 !important; background-color: #2a4a3a !important; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @media print { body { background: white !important; color: black !important; } .no-print { display: none !important; } }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1F3B2C; }
        ::-webkit-scrollbar-thumb { background-color: #96E6B3; border-radius: 4px; }
        .object-cover { object-fit: cover; }
        .max-h-\[90vh\] { max-height: 90vh; }
        
        /* Info button styling - clean white icon */
        .info-btn { 
            cursor: pointer; 
            opacity: 0.6; 
            transition: opacity 0.2s ease;
            color: white;
            background: none;
            border: none;
            padding: 0;
            margin: 0;
            font-size: inherit;
            line-height: inherit;
        }
        .info-btn:hover { 
            opacity: 1; 
        }
        
        /* Beta badge styling */
        .beta-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 0.75rem;
            font-weight: 400;
            margin-left: 8px;
            vertical-align: middle;
        }
        
        /* File preview sticky positioning */
        .file-preview-sticky {
            position: sticky;
            top: 20px;
            z-index: 20;
            background: rgba(31, 59, 44, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Consistent box spacing */
        .analysis-box {
            margin-bottom: 1.5rem;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 1rem;
        }
        
        /* Minimal icons */
        .icon-check {
            color: #96E6B3;
            font-weight: bold;
        }
        .icon-cross {
            color: white;
            font-weight: normal;
        }
        .icon-neutral {
            color: #fbbf24;
            font-weight: normal;
        }
        
        /* Color swatch styling */
        .color-swatch {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            display: inline-block;
            margin-right: 8px;
            vertical-align: middle;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        /* Improved spacing for boxes */
        .metric-box {
            padding: 1.25rem;
        }
        
        .recommendation-box {
            padding: 1.25rem;
        }
        
        /* Canvas per analisi colore */
        #color-analysis-canvas {
            display: none;
        }
        
        /* Clean delete button styling - no background box */
        .delete-btn {
            color: white;
            background: none;
            border: none;
            padding: 0;
            margin: 0;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s ease;
            font-size: 1.25rem;
        }
        .delete-btn:hover {
            opacity: 1;
        }
        
        /* Clean menu button styling - white text, no background */
        .menu-btn {
            color: white !important;
            background: none !important;
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
            cursor: pointer;
            transition: color 0.2s ease;
            font-size: 0.875rem;
            font-weight: 500;
            text-decoration: none;
            outline: none;
            box-shadow: none;
        }
        .menu-btn:hover {
            color: #96E6B3 !important;
        }
        .menu-btn:focus {
            outline: none;
            box-shadow: none;
        }

        /* Assicura che il pulsante di chiusura del modal non abbia sfondo n√© bordo */
        .modal-close {
            background: none !important;
            border: none !important;
            padding: 0;
            margin: 0;
            color: #ffffff;
        }
    </style>
</head>
<body class="min-h-screen bg-[#1F3B2C] text-white">
    <div id="app"></div>
    <canvas id="color-analysis-canvas"></canvas>

    <script>
        class NovaSustainabilityAnalyzer {
            constructor() {
                this.uploadedFile = null;
                this.analysisResults = null;
                this.isAnalyzing = false;
                this.error = null;
                this.activeModal = null;
                this.colorAnalysisData = null;
                this.currentView = 'main'; // 'main' or 'discover-more'
                this.init();
                window.novaApp = this; // Espongo l'istanza globalmente
            }

            init() {
                this.render();
                this.attachEventListeners();
            }

            attachEventListeners() {
                const appContainer = document.getElementById('app');
                
                // File upload events
                appContainer.addEventListener('change', e => {
                    if (e.target.id === 'file-upload') this.handleFileInput(e);
                });
                
                // Drag and drop events
                appContainer.addEventListener('dragenter', e => {
                    if (e.target.closest('#upload-area')) this.handleDrag(e, true);
                });
                appContainer.addEventListener('dragover', e => {
                    if (e.target.closest('#upload-area')) this.handleDrag(e, true);
                });
                appContainer.addEventListener('dragleave', e => {
                    if (e.target.closest('#upload-area')) this.handleDrag(e, false);
                });
                appContainer.addEventListener('drop', e => {
                    if (e.target.closest('#upload-area')) this.handleDrop(e);
                });

                // Button clicks
                appContainer.addEventListener('click', e => {
                    if (e.target.closest('#analyze-btn')) this.analyzeFile();
                    if (e.target.closest('#remove-btn')) this.removeFile();
                    if (e.target.closest('#new-analysis-btn')) this.startNewAnalysis();
                    if (e.target.closest('#new-analysis-menu-btn')) this.startNewAnalysis();
                    if (e.target.closest('#discover-more-btn')) this.showDiscoverMore();
                    if (e.target.closest('#download-cert-btn')) this.downloadCertificate();
                    
                    const infoButton = e.target.closest('.info-btn');
                    if (infoButton) {
                        e.preventDefault();
                        this.showModal(infoButton.dataset.modal);
                    }
                });

                // Modal events
                document.body.addEventListener('click', e => {
                    if (e.target.classList.contains('modal-close') || e.target.id === 'modal-backdrop') {
                        this.hideModal();
                    }
                });
                
                document.addEventListener('keydown', e => {
                    if (e.key === "Escape") this.hideModal();
                });
            }

            handleDrag(e, isActive) {
                e.preventDefault();
                e.stopPropagation();
                const uploadArea = document.getElementById('upload-area');
                if (uploadArea) {
                    uploadArea.classList.toggle('drag-active', isActive);
                }
            }

            handleDrop(e) {
                this.handleDrag(e, false);
                if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                    this.handleFile(e.dataTransfer.files[0]);
                }
            }

            handleFileInput(e) {
                if (e.target.files && e.target.files[0]) {
                    this.handleFile(e.target.files[0]);
                }
            }

            handleFile(file) {
                this.error = null;
                const validTypes = ['image/jpeg', 'image/png', 'image/webp', 'image/svg+xml', 'application/pdf'];
                
                if (!validTypes.includes(file.type)) {
                    this.error = 'Formato file non supportato. Usa JPG, PNG, WebP, SVG o PDF.';
                    this.render();
                    return;
                }
                
                if (file.size > 15 * 1024 * 1024) {
                    this.error = 'File troppo grande. Dimensione massima: 15MB.';
                    this.render();
                    return;
                }

                const reader = new FileReader();
                reader.onload = e => {
                    this.uploadedFile = {
                        name: file.name,
                        size: file.size,
                        type: file.type,
                        url: e.target.result
                    };
                    this.analysisResults = null;
                    this.colorAnalysisData = null;
                    this.render();
                };
                reader.onerror = () => {
                    this.error = 'Errore durante la lettura del file.';
                    this.render();
                };
                reader.readAsDataURL(file);
            }

            removeFile() {
                this.uploadedFile = null;
                this.analysisResults = null;
                this.error = null;
                this.colorAnalysisData = null;
                this.render();
            }

            showDiscoverMore() {
                this.currentView = 'discover-more';
                this.render();
            }

            startNewAnalysis() {
                this.uploadedFile = null;
                this.analysisResults = null;
                this.isAnalyzing = false;
                this.error = null;
                this.currentView = 'main';
                this.render();
            }

            // Analisi avanzata dei colori dell'immagine
            analyzeImageColors() {
                return new Promise((resolve) => {
                    if (!this.uploadedFile || !this.uploadedFile.type.startsWith('image/')) {
                        resolve({
                            dominantColors: ['#FFFFFF', '#000000'],
                            contrastRatio: 21.0,
                            averageBrightness: 0.5,
                            hasGoodContrast: true,
                            textCharacterCount: 0
                        });
                        return;
                    }

                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.getElementById('color-analysis-canvas');
                        const ctx = canvas.getContext('2d');
                        
                        // Ridimensiona per analisi pi√π veloce
                        const maxSize = 200;
                        const scale = Math.min(maxSize / img.width, maxSize / img.height);
                        canvas.width = img.width * scale;
                        canvas.height = img.height * scale;
                        
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        
                        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                        const data = imageData.data;
                        
                        const colorCounts = {};
                        let totalBrightness = 0;
                        let pixelCount = 0;
                        
                        // Analizza ogni pixel
                        for (let i = 0; i < data.length; i += 4) {
                            const r = data[i];
                            const g = data[i + 1];
                            const b = data[i + 2];
                            const a = data[i + 3];
                            
                            if (a < 128) continue; // Skip pixels trasparenti
                            
                            // Calcola luminosit√†
                            const brightness = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
                            totalBrightness += brightness;
                            pixelCount++;
                            
                            // Raggruppa colori simili (limitando a 0-255)
                            const groupedR = Math.min(255, Math.round(r/32)*32);
                            const groupedG = Math.min(255, Math.round(g/32)*32);
                            const groupedB = Math.min(255, Math.round(b/32)*32);
                            const colorKey = `${groupedR},${groupedG},${groupedB}`;
                            colorCounts[colorKey] = (colorCounts[colorKey] || 0) + 1;
                        }
                        
                        // Trova i colori dominanti
                        const sortedColors = Object.entries(colorCounts)
                            .sort(([,a], [,b]) => b - a)
                            .slice(0, 10)
                            .map(([color]) => {
                                const [r, g, b] = color.split(',').map(Number);
                                // Assicura che i valori siano nel range 0-255
                                const validR = Math.max(0, Math.min(255, r));
                                const validG = Math.max(0, Math.min(255, g));
                                const validB = Math.max(0, Math.min(255, b));
                                return { 
                                    r: validR, 
                                    g: validG, 
                                    b: validB, 
                                    hex: `#${validR.toString(16).padStart(2,'0')}${validG.toString(16).padStart(2,'0')}${validB.toString(16).padStart(2,'0')}` 
                                };
                            });
                        
                        const averageBrightness = totalBrightness / pixelCount;
                        
                        // Stima il numero di caratteri basato sulla dimensione del file
                        // File promozionali tipici hanno ~1 carattere ogni 1-2KB
                        const estimatedCharacters = Math.round(this.uploadedFile.size / 1500);
                        
                        // Calcola contrasto tra i due colori pi√π comuni
                        let contrastRatio = 1.0;
                        let hasGoodContrast = false;
                        
                        if (sortedColors.length >= 2) {
                            // Trova il colore pi√π chiaro e pi√π scuro tra i dominanti
                            let lightestColor = sortedColors[0];
                            let darkestColor = sortedColors[0];

                            for (let i = 1; i < sortedColors.length; i++) {
                                const currentColor = sortedColors[i];
                                const currentLum = this.calculateLuminance(currentColor.r, currentColor.g, currentColor.b);
                                if (currentLum > this.calculateLuminance(lightestColor.r, lightestColor.g, lightestColor.b)) {
                                    lightestColor = currentColor;
                                }
                                if (currentLum < this.calculateLuminance(darkestColor.r, darkestColor.g, darkestColor.b)) {
                                    darkestColor = currentColor;
                                }
                            }
                            
                            const lum1 = this.calculateLuminance(lightestColor.r, lightestColor.g, lightestColor.b);
                            const lum2 = this.calculateLuminance(darkestColor.r, darkestColor.g, darkestColor.b);
                            
                            contrastRatio = (Math.max(lum1, lum2) + 0.05) / (Math.min(lum1, lum2) + 0.05);
                            hasGoodContrast = contrastRatio >= 4.5;
                        }
                        
                        resolve({
                            dominantColors: sortedColors.map(c => c.hex),
                            contrastRatio: Math.round(contrastRatio * 100) / 100,
                            averageBrightness,
                            hasGoodContrast,
                            totalPixels: pixelCount,
                            textCharacterCount: estimatedCharacters
                        });
                    };
                    
                    img.onerror = () => {
                        resolve({
                            dominantColors: ['#FFFFFF', '#000000'],
                            contrastRatio: 7.0,
                            averageBrightness: 0.5,
                            hasGoodContrast: true,
                            textCharacterCount: 0
                        });
                    };
                    
                    img.src = this.uploadedFile.url;
                });
            }
            
            calculateLuminance(r, g, b) {
                const [rs, gs, bs] = [r, g, b].map(c => {
                    c = c / 255;
                    return c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);
                });
                return 0.2126 * rs + 0.7152 * gs + 0.0722 * bs;
            }

            // --- Analisi Functions ---
            async analyzeFile(skipRender = false) {
                if (!this.uploadedFile) return;
                
                this.isAnalyzing = true;
                this.error = null;
                if (!skipRender) this.render();
                
                // Simula tempo di analisi
                await new Promise(resolve => setTimeout(resolve, 2000));

                try {
                    const sizeInMB = this.uploadedFile.size / (1024 * 1024);
                    
                    // Analisi colori per immagini
                    this.colorAnalysisData = await this.analyzeImageColors();
                    
                    // Calcolo impatto ambientale
                    const environmental = this.calculateEnvironmentalImpact(sizeInMB);
                    
                    // Analisi accessibilit√† migliorata
                    const accessibility = this.analyzeAccessibility();
                    
                    // Analisi sostenibilit√† economica
                    const economic = this.analyzeEconomicSustainability();
                    
                    // Calcolo punteggio complessivo
                    const overallScore = Math.round(
                        (environmental.score * 0.4) + 
                        (accessibility.score * 0.35) + 
                        (economic.score * 0.25)
                    );

                    this.analysisResults = {
                        overallScore,
                        environmental,
                        accessibility,
                        economic
                    };

                } catch (error) {
                    // Use double-quoted strings to avoid prematurely ending the string due to apostrophes
                    console.error("Errore durante l'analisi:", error);
                    this.error = "Errore durante l'analisi del file. Riprova.";
                } finally {
                    this.isAnalyzing = false;
                    this.render();
                }
            }

            calculateEnvironmentalImpact(sizeInMB) {
                /*
                 * Calcolo dell'impatto ambientale basato sul Sustainable Web Design Model (SWDM).
                 * Il modello divide i consumi energetici tra data center, rete e dispositivi utente e
                 * utilizza l'intensit√† carbonica della rete per convertire i kWh in grammi di CO‚ÇÇe.
                 * Fonte: Sustainable Web Design Model 2024„Äê363710125564870‚Ä†L63-L75„Äë„Äê552450473791055‚Ä†L213-L246„Äë.
                 */
                // Converti la dimensione in MB in GB per l'uso delle intensit√† energetiche per GB
                const sizeInGB = sizeInMB / 1024;

                // Intensit√† energetiche operative (kWh/GB) per i tre segmenti
                // Data center: 0.055 kWh/GB, rete: 0.059 kWh/GB, dispositivi utente: 0.080 kWh/GB„Äê552450473791055‚Ä†L213-L246„Äë
                const energyIntensity = {
                    dataCenter: 0.055,
                    network: 0.059,
                    userDevice: 0.080
                };
                // Intensit√† energetiche embody (non utilizzate qui ma disponibili per future estensioni)
                // const embodiedIntensity = { dataCenter: 0.012, network: 0.013, userDevice: 0.081 };

                // Converti da kWh/GB a kWh/MB per comodit√†
                const energyPerMB = {
                    dataCenter: energyIntensity.dataCenter / 1024,
                    network: energyIntensity.network / 1024,
                    userDevice: energyIntensity.userDevice / 1024
                };

                // Intensit√† carbonica (g CO‚ÇÇe/kWh). Per un calcolo pi√π accurato √® possibile sostituire
                // questo valore con l'intensit√† locale della rete elettrica„Äê552450473791055‚Ä†L118-L131„Äë.
                const CARBON_INTENSITY_G_PER_KWH = 494;

                // Water Usage Effectiveness (WUE) in litri per kWh. L'articolo di TechTarget riporta
                // un valore medio di 1,8 L/kWh per i data center„Äê8268087492799‚Ä†L193-L204„Äë. Utilizziamo
                // questo dato come riferimento; un valore inferiore (ad es. 0,15 L/kWh) pu√≤ essere
                // impostato per data center particolarmente efficienti.
                const WUE_L_PER_KWH = 1.8;

                // Calcolo CO‚ÇÇe per upload: si considera l'energia del data center per salvare
                // il contenuto e l'energia della rete per il trasferimento. Nessuna energia del
                // dispositivo utente viene consumata durante l'upload.
                const co2Upload = sizeInMB * (energyPerMB.dataCenter + energyPerMB.network) * CARBON_INTENSITY_G_PER_KWH;

                // Calcolo CO‚ÇÇe per visualizzazione: include data center, rete e dispositivo utente.
                const baseCo2View = sizeInMB * (energyPerMB.dataCenter + energyPerMB.network + energyPerMB.userDevice) * CARBON_INTENSITY_G_PER_KWH;

                // Fattore colore per schermi OLED: penalizza contenuti con luminosit√† molto alta
                // sui dispositivi OLED, aumentando il consumo energetico del dispositivo utente.
                let colorFactor = 0;
                let co2ViewColor = baseCo2View;
                const oledPenetration = 0.25; // ~25% dei dispositivi utilizzano schermi OLED
                if (this.colorAnalysisData && this.colorAnalysisData.averageBrightness > 0.8) {
                    // Solo per luminosit√† media > 80%. Penalit√† fino a ~3% per colori molto chiari
                    const brightnessPenalty = (this.colorAnalysisData.averageBrightness - 0.8) * 15;
                    // Applica la penalit√† ridotta dalla penetrazione degli OLED
                    colorFactor = Math.round(brightnessPenalty * oledPenetration * 10) / 10;
                    // Aumenta il consumo solo della quota di visualizzazione. Il fattore agisce su tutto
                    // il consumo di visualizzazione per semplicit√†, come nel modello precedente.
                    co2ViewColor = baseCo2View * (1 + colorFactor / 100);
                }

                // Calcola il consumo di acqua (ml) basato su WUE. Solo l'energia del data center
                // contribuisce direttamente al consumo idrico, poich√© la WUE misura l'acqua per
                // raffreddare i server„Äê8268087492799‚Ä†L193-L204„Äë.
                const h2oUpload = sizeInMB * energyPerMB.dataCenter * WUE_L_PER_KWH * 1000; // ml
                let h2oView = sizeInMB * energyPerMB.dataCenter * WUE_L_PER_KWH * 1000;
                // Se √® applicato il fattore colore, aumentiamo proporzionalmente anche il consumo d'acqua
                if (colorFactor > 0) {
                    h2oView = h2oView * (1 + colorFactor / 100);
                }

                // Approssima e arrotonda i valori per la presentazione
                const co2UploadG = Math.round(co2Upload * 1000) / 1000;
                const co2ViewColorG = Math.round(co2ViewColor * 1000) / 1000;
                const h2oUploadMl = Math.round(h2oUpload * 10) / 10;
                const h2oViewMl = Math.round(h2oView * 10) / 10;

                // Calcola punteggio ambientale basato su soglie dimensionali e penalit√† colori.
                let score = 100;
                if (sizeInMB > 5) score -= 30;
                else if (sizeInMB > 2) score -= 15;
                else if (sizeInMB > 1) score -= 5;
                if (colorFactor > 0.5) score -= Math.round(colorFactor);
                score = Math.max(0, Math.min(100, score));

                return {
                    score: Math.round(score),
                    fileWeightMB: Math.round(sizeInMB * 100) / 100,
                    co2UploadG,
                    co2ViewColorG,
                    h2oUploadMl,
                    h2oViewMl,
                    colorFactor: Math.round(colorFactor * 10) / 10
                };
            }

            analyzeAccessibility() {
                let score = 100;
                let wcagLevel = 'AAA';
                
                // ANALISI CONTRASTO REALISTICA BASATA SU ANALISI COLORI EFFETTIVA
                const contrastRatio = this.colorAnalysisData ? this.colorAnalysisData.contrastRatio : 7.0;
                const averageBrightness = this.colorAnalysisData ? this.colorAnalysisData.averageBrightness : 0.5;
                
                // Per contenuti con colori chiari dominanti (come card promozionali verdi/colorate)
                // il contrasto √® spesso problematico
                let effectiveContrast = contrastRatio;
                
                // Se il contenuto ha luminosit√† media alta (>0.6) probabilmente ha problemi di contrasto
                if (averageBrightness > 0.6) {
                    // Riduci il contrasto stimato per contenuti molto colorati
                    effectiveContrast = Math.max(2.0, contrastRatio * 0.7);
                }
                
                // Per file grandi (>500KB) che sono spesso design complessi, 
                // il contrasto √® statisticamente peggiore
                if (this.uploadedFile.size > 500000) {
                    effectiveContrast = Math.max(2.5, effectiveContrast * 0.8);
                }
                
                const hasGoodContrast = effectiveContrast >= 4.5;
                
                // Classificazione WCAG basata su contrasto effettivo
                if (effectiveContrast < 3) {
                    score -= 50;
                    wcagLevel = 'Non conforme';
                } else if (effectiveContrast < 4.5) {
                    score -= 40; // Penalit√† severa per AA non raggiunto
                    wcagLevel = 'A (limitato)';
                } else if (effectiveContrast < 7) {
                    score -= 15;
                    wcagLevel = 'AA';
                } // >= 7 rimane AAA
                
                // Analisi reale del testo alternativo
                // Un file immagine caricato per definizione non ha testo alternativo
                // Il testo alternativo deve essere aggiunto quando l'immagine viene inserita nel web
                const hasAltText = false; // Sempre false per file immagini standalone
                
                // Analisi deterministica altri fattori
                const fileHash = this.simpleFileHash(this.uploadedFile.name + this.uploadedFile.size);
                const isComplexDesign = this.uploadedFile.size > 500000;
                    
                const hasTextInImage = isComplexDesign ?
                    (fileHash % 10) < 8 :  // 80% probabilit√† per design complessi
                    (fileHash % 10) < 4;   // 40% per design semplici
                    
                const fontReadability = isComplexDesign ?
                    (fileHash % 10) > 6 :  // Solo 30% probabilit√† per design complessi  
                    (fileHash % 10) > 2;   // 70% per design semplici
                
                // Penalit√† proporzionate alla gravit√†
                if (!hasAltText) score -= 25;
                if (hasTextInImage) score -= 20;
                if (!fontReadability) score -= 15;
                
                // Penalit√† extra per design complessi che sono intrinsecamente meno accessibili
                if (isComplexDesign) {
                    score -= 10;
                }
                
                score = Math.max(0, Math.min(100, score));

                return {
                    score: Math.round(score),
                    contrastRatio: effectiveContrast.toFixed(1),
                    hasGoodContrast,
                    hasAltText,
                    hasTextInImage,
                    fontReadability,
                    wcagLevel,
                    dominantColors: this.colorAnalysisData ? this.colorAnalysisData.dominantColors.slice(0, 5) : []
                };
            }

            analyzeEconomicSustainability() {
                // Analisi basata su caratteristiche oggettive del file
                // Usiamo un semplice hash per simulare la presenza di un design system.
                const fileHash = this.simpleFileHash(this.uploadedFile.name + this.uploadedFile.size);

                // Design system: valutazione basata su dimensione e complessit√†
                // Se l'hash produce un numero elevato, presumiamo l'utilizzo di un design system.
                const usesDesignSystem = (fileHash % 10) > 3; // ~60% di probabilit√†

                /*
                 * Font open source:
                 * Per i PDF, effettuiamo una scansione del contenuto (in base64) alla ricerca di
                 * nomi di alcuni tra i pi√π diffusi font open source (es. Roboto, Open Sans,
                 * Lato, Montserrat, Poppins, Source Sans Pro, Inter, Raleway, Nunito,
                 * Merriweather). Se almeno un font viene individuato, assegnamo un punteggio
                 * positivo alla sostenibilit√† economica. Per le immagini non √® possibile
                 * determinare il font dal file stesso, quindi assumiamo l'uso di font proprietari.
                 */
                let usesOpenSourceFonts = false;
                if (this.uploadedFile.type === 'application/pdf') {
                    try {
                        // Estrai la parte base64 dell'URL (dopo la virgola)
                        const base64 = this.uploadedFile.url.split(',')[1] || '';
                        // Decodifica solo i primi ~50 kB per evitare costi elevati
                        const sample = base64.slice(0, 50000);
                        const decoded = atob(sample);
                        const lowerDecoded = decoded.toLowerCase();
                        const openFonts = [
                            'roboto',
                            'open sans',
                            'lato',
                            'montserrat',
                            'poppins',
                            'source sans pro',
                            'inter',
                            'raleway',
                            'nunito',
                            'merriweather'
                        ];
                        usesOpenSourceFonts = openFonts.some(fontName => lowerDecoded.includes(fontName));
                    } catch (err) {
                        // In caso di errore nella decodifica, mantieni l'ipotesi conservativa
                        usesOpenSourceFonts = false;
                    }
                }

                // Layout semplice: un file pi√π piccolo suggerisce un layout pi√π essenziale
                const hasSimpleLayout = this.uploadedFile.size < 2 * 1024 * 1024; // <2 MB

                // Calcolo punteggio: partiamo da 50 e aggiungiamo bonus
                let score = 50;
                if (usesDesignSystem) score += 25;
                if (usesOpenSourceFonts) score += 15;
                if (hasSimpleLayout) score += 10;
                score = Math.max(0, Math.min(100, score));

                return {
                    score: Math.round(score),
                    usesDesignSystem,
                    usesOpenSourceFonts,
                    hasSimpleLayout
                };
            }

            // Funzione di hash semplice per risultati deterministici
            simpleFileHash(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) {
                    const char = str.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash; // Convert to 32-bit integer
                }
                return Math.abs(hash);
            }

            getScoreLabel(score) {
                if (score >= 90) return 'Eccellente';
                if (score >= 80) return 'Ottimo';
                if (score >= 70) return 'Buono';
                if (score >= 60) return 'Sufficiente';
                if (score >= 50) return 'Migliorabile';
                return 'Critico';
            }

            downloadCertificate() {
                if (!this.analysisResults) return;
                
                const { overallScore, environmental, accessibility, economic } = this.analysisResults;
                const now = new Date();
                const dateStr = now.toLocaleDateString('it-IT');
                const timeStr = now.toLocaleTimeString('it-IT');
                
                // Crea il certificato in formato HTML
                const certificateHTML = `
<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Certificato di Sostenibilit√† Digitale - ${this.uploadedFile.name}</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            line-height: 1.6;
            color: #212529;
            max-width: 800px;
            margin: 0 auto;
            padding: 40px 20px;
            background: #ffffff;
        }
        .certificate {
            background: white;
            padding: 60px 40px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            border: 3px solid #2d5f3f;
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
            border-bottom: 2px solid #2d5f3f;
            padding-bottom: 30px;
        }
        .title {
            font-size: 2.5em;
            color: #1a472a;
            margin: 0 0 10px 0;
            font-weight: bold;
        }
        .subtitle {
            font-size: 1.2em;
            color: #495057;
            margin: 0;
        }
        .file-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin: 30px 0;
            border-left: 4px solid #2d5f3f;
        }
        .score-section {
            text-align: center;
            margin: 40px 0;
            padding: 30px;
            background: #1a472a;
            color: white;
            border-radius: 12px;
        }
        .overall-score {
            font-size: 4em;
            font-weight: bold;
            color: #ffffff;
            margin: 0;
        }
        .score-label {
            font-size: 1.5em;
            margin: 10px 0 0 0;
            color: #f8f9fa;
        }
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }
        .metric-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #dee2e6;
        }
        .metric-title {
            font-weight: bold;
            color: #1a472a;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        .metric-value {
            font-size: 2em;
            color: #2d5f3f;
            font-weight: bold;
        }
        .environmental-details {
            margin: 30px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .environmental-details h3 {
            margin-top: 0;
            color: #1a472a;
        }
        .footer {
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #dee2e6;
            text-align: center;
            color: #495057;
            font-size: 0.95em;
        }
        .nova-brand {
            color: #1a472a;
            font-weight: bold;
        }
        .beta-badge {
            background: #2d5f3f;
            color: #ffffff;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.7em;
            font-weight: bold;
        }
        .footer a {
            color: #1a472a;
            text-decoration: underline;
        }
        .footer a:hover {
            color: #2d5f3f;
        }
        @media print {
            body { 
                background: white;
                color: #000000;
            }
            .certificate { 
                box-shadow: none;
                border-color: #000000;
            }
            .score-section {
                background: #f8f9fa;
                color: #000000;
                border: 2px solid #000000;
            }
            .overall-score, .score-label {
                color: #000000;
            }
        }
    </style>
</head>
<body>
    <div class="certificate">
        <div class="header">
            <h1 class="title">Certificato di Sostenibilit√† Digitale</h1>
            <p class="subtitle">Analisi dell'impatto ambientale e dell'accessibilit√†</p>
        </div>
        
        <div class="file-info">
            <h3 style="margin-top: 0; color: #1a472a;">File Analizzato</h3>
            <p><strong>Nome:</strong> ${this.uploadedFile.name}</p>
            <p><strong>Dimensione:</strong> ${environmental.fileWeightMB} MB</p>
            <p><strong>Tipo:</strong> ${this.uploadedFile.type}</p>
            <p><strong>Data analisi:</strong> ${dateStr} alle ${timeStr}</p>
        </div>

        <div class="score-section">
            <div class="overall-score">${overallScore}/100</div>
            <div class="score-label">${this.getScoreLabel(overallScore)}</div>
        </div>

        <div class="metrics">
            <div class="metric-card">
                <div class="metric-title">üå± Sostenibilit√† Ambientale</div>
                <div class="metric-value">${environmental.score}/100</div>
            </div>
            <div class="metric-card">
                <div class="metric-title">üëÅÔ∏è Accessibilit√†</div>
                <div class="metric-value">${accessibility.score}/100</div>
                <p style="margin: 10px 0 0 0; font-size: 0.9em; color: #495057;">Livello WCAG: ${accessibility.wcagLevel}</p>
            </div>
            <div class="metric-card">
                <div class="metric-title">üí∞ Sostenibilit√† Economica</div>
                <div class="metric-value">${economic.score}/100</div>
            </div>
        </div>

        <div class="environmental-details">
            <h3>Dettagli Sostenibilit√† Ambientale</h3>
            <p><strong>CO‚ÇÇ per upload:</strong> ${environmental.co2UploadG}g</p>
            <p><strong>CO‚ÇÇ per visualizzazione:</strong> ${environmental.co2ViewColorG}g</p>
            <p><strong>Consumo acqua upload:</strong> ${environmental.h2oUploadMl} ml</p>
            <p><strong>Consumo acqua visualizzazione:</strong> ${environmental.h2oViewMl} ml</p>
            ${environmental.colorFactor > 0 ? `<p><strong>Penalit√† colori OLED:</strong> ${environmental.colorFactor}%</p>` : ''}
        </div>

        <div class="footer">
            <p><span class="nova-brand">Nova</span> <span class="beta-badge">beta</span> - Analisi di sostenibilit√† digitale basata su Sustainable Web Design Model 2024 e linee guida WCAG 2.1</p>
            <p style="margin-top: 15px;">
                L'analisi non sostituisce una valutazione scientifica o tecnica professionale. Il suo scopo √® fornire un'indicazione orientativa e contribuire alla sensibilizzazione verso un approccio pi√π etico, accessibile e sostenibile nella progettazione di contenuti digitali.
            </p>
        </div>
    </div>
</body>
</html>`;

                // Crea il file HTML per il download
                const fileName = `certificato-sostenibilita-${this.uploadedFile.name.split('.')[0]}.html`;
                const blob = new Blob([certificateHTML], { type: 'text/html; charset=utf-8' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            showModal(modalId) {
                this.activeModal = modalId;
                this.render();
            }

            hideModal() {
                this.activeModal = null;
                this.render();
            }

            render() {
                const app = document.getElementById('app');
                if (!app) return;

                if (this.currentView === 'discover-more') {
                    app.innerHTML = this.renderDiscoverMore();
                    return;
                }

                app.innerHTML = `
                    <div class="min-h-screen flex flex-col p-6 lg:p-8">
                        <header class="mb-8 no-print max-w-4xl mx-auto w-full">
                            <div class="flex items-center justify-between mb-6">
                                <nav class="flex items-center gap-6">
                                    <button id="discover-more-btn" class="menu-btn">
                                        Scopri di pi√π
                                    </button>
                                </nav>
                            </div>
                            <div class="text-center">
                                <h1 class="text-4xl font-bold text-[#96E6B3] mb-4">
                                    Nova<span class="beta-badge">beta</span>
                                </h1>
                                <p class="text-white/80 text-lg">Analizza l'impatto dei tuoi contenuti digitali per un web pi√π etico, accessibile e sostenibile.</p>
                            </div>
                        </header>

                        <main class="w-full max-w-4xl mx-auto flex-grow">
                            ${this.isAnalyzing ? this.renderLoader() : ''}
                            ${!this.isAnalyzing && !this.uploadedFile ? this.renderUploadArea() : ''}
                            ${!this.isAnalyzing && this.uploadedFile && !this.analysisResults ? this.renderFilePreview() : ''}
                            ${this.error ? this.renderError() : ''}
                            ${this.analysisResults ? this.renderResultsWithPreview() : ''}
                        </main>
                        
                        ${this.analysisResults ? this.renderFooter() : ''}
                    </div>
                    ${this.renderModals()}
                `;
            }

            renderDiscoverMore() {
                return `
                    <div class="min-h-screen bg-[#1F3B2C] text-white p-6 lg:p-8">
                        <div class="max-w-4xl mx-auto">
                            <header class="mb-8">
                                <nav class="mb-6">
                                    <button id="new-analysis-menu-btn" class="menu-btn">
                                        ‚Üê Torna a Nova
                                    </button>
                                </nav>
                            </header>

                            <main class="max-w-3xl mx-auto">
                                <h1 class="text-4xl font-bold text-[#96E6B3] mb-8">Cos'√® Nova</h1>
                                
                                <div class="prose prose-lg max-w-none space-y-6">
                                    <p class="text-lg text-white/80 leading-relaxed">
                                        Nova √® uno strumento open source che analizza la sostenibilit√† digitale dei contenuti web in modo semplice, automatico e accessibile.
                                    </p>
                                    
                                    <p class="text-lg text-white/80 leading-relaxed">
                                        L'obiettivo del progetto √® aiutare designer, sviluppatori e redattori a migliorare l'impatto ambientale, economico e sociale dei propri contenuti online.
                                    </p>
                                    
                                    <p class="text-lg text-white/80 leading-relaxed">
                                        Le analisi fornite si basano su criteri condivisi a livello internazionale, combinando metriche ambientali, aspetti di usabilit√† e accessibilit√† digitale.
                                    </p>
                                    
                                    <p class="text-lg text-white/80 leading-relaxed">
                                        Nova √® in costante evoluzione e aperta al contributo della community.
                                    </p>
                                    
                                    <div class="mt-12 pt-8 border-t border-white/20">
                                        <p class="text-lg text-white/80 mb-4">Segui Nova su</p>
                                        <div class="flex items-center gap-4">
                                            <a href="#" class="flex items-center gap-2 text-white/70 hover:text-[#96E6B3] transition-colors">
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                                    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                                                </svg>
                                                Instagram
                                            </a>
                                            <a href="#" class="flex items-center gap-2 text-white/70 hover:text-[#96E6B3] transition-colors">
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                                    <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                                                </svg>
                                                LinkedIn
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </main>
                        </div>
                    </div>
                `;
            }

            renderLoader() {
                return `
                    <div class="text-center p-8 fade-in">
                        <div class="w-16 h-16 border-4 border-[#96E6B3] border-t-transparent rounded-full animate-spin mx-auto"></div>
                        <p class="mt-6 text-xl text-white">Analisi in corso...</p>
                        <p class="text-white/70 mt-2">Analizzando colori, contrasto, impatto ambientale e sostenibilit√† economica</p>
                    </div>
                `;
            }

            renderUploadArea() {
                return `
                    <div id="upload-area" class="relative border-2 border-dashed border-white/40 rounded-2xl p-8 text-center cursor-pointer transition-all duration-300 hover:border-[#96E6B3] hover:bg-white/5">
                        <input type="file" id="file-upload" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" accept="image/*,.pdf">
                        <div class="flex flex-col items-center justify-center space-y-6">
                            <div class="text-6xl text-[#96E6B3]">‚Üë</div>
                            <div>
                                <p class="text-xl font-medium text-white mb-2">Trascina un file qui o clicca per caricare</p>
                                <p class="text-white/70">Supporta Immagini (JPG, PNG, WebP, SVG) e PDF. Max 15MB.</p>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderFilePreview() {
                const isImage = this.uploadedFile.type.startsWith('image/');
                return `
                    <div class="bg-white/5 border border-white/20 rounded-2xl p-6 fade-in">
                        <div class="flex flex-col sm:flex-row items-center gap-6">
                            ${isImage ? 
                                `<img src="${this.uploadedFile.url}" alt="Anteprima" class="w-20 h-20 object-contain rounded-lg border border-white/30">` :
                                `<div class="w-20 h-20 flex items-center justify-center bg-white/10 rounded-lg border border-white/30">
                                    <div class="text-2xl text-[#96E6B3]">üìÑ</div>
                                 </div>`
                            }
                            <div class="flex-grow text-center sm:text-left">
                                <p class="font-semibold text-xl text-white truncate">${this.uploadedFile.name}</p>
                                <p class="text-white/70 mt-1">${(this.uploadedFile.size / 1024 / 1024).toFixed(2)} MB ‚Ä¢ ${this.uploadedFile.type}</p>
                            </div>
                            <div class="flex items-center gap-4 mt-4 sm:mt-0">
                                <button id="remove-btn" class="delete-btn" title="Rimuovi file">
                                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2m3 0v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6h14ZM10 11v6M14 11v6"/>
                                    </svg>
                                </button>
                                <button id="analyze-btn" class="bg-[#96E6B3] text-[#1F3B2C] font-semibold py-4 px-14 sm:px-24 rounded-lg hover:bg-white transition-colors">
                                    Analizza
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderResultsWithPreview() {
                const isImage = this.uploadedFile.type.startsWith('image/');
                return `
                    <div class="fade-in">
                        <!-- File preview sticky -->
                        <div class="file-preview-sticky mb-6 p-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-4">
                                    ${isImage ? 
                                        `<img src="${this.uploadedFile.url}" alt="Anteprima" class="w-16 h-16 object-cover rounded border border-white/30">` :
                                        `<div class="w-16 h-16 flex items-center justify-center bg-white/10 rounded border border-white/30">
                                            <div class="text-lg text-[#96E6B3]">üìÑ</div>
                                         </div>`
                                    }
                                    <div>
                                        <p class="font-medium text-white truncate">${this.uploadedFile.name}</p>
                                        <p class="text-sm text-white/70">${(this.uploadedFile.size / 1024 / 1024).toFixed(2)} MB</p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-3">
                                    <button id="remove-btn" class="delete-btn" title="Rimuovi file">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2m3 0v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6h14ZM10 11v6M14 11v6"/>
                                        </svg>
                                    </button>
                                    <button id="new-analysis-btn" class="bg-[#96E6B3] text-[#1F3B2C] font-medium py-2 px-4 rounded-lg hover:bg-white transition-colors text-sm">
                                        Nuova analisi
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        ${this.renderResults()}
                    </div>
                `;
            }

            renderError() {
                return `
                    <div class="bg-red-900/50 border border-red-500 text-red-300 p-4 rounded-lg mt-4 flex items-center gap-3 fade-in">
                        <span>‚ö†</span>
                        <span>${this.error}</span>
                    </div>
                `;
            }

            renderResults() {
                const { overallScore, environmental, accessibility, economic } = this.analysisResults;
                const overallLabel = this.getScoreLabel(overallScore);
                
                return `
                    <div class="space-y-6">
                        <!-- Punteggio complessivo -->
                        <div class="analysis-box text-center">
                            <h2 class="text-3xl font-bold text-[#96E6B3] mb-6">Punteggio complessivo</h2>
                            <div class="text-6xl font-bold text-white mb-4">${overallScore}/100</div>
                            <div class="text-2xl font-medium text-[#96E6B3] mb-6">${overallLabel}</div>
                            <button id="download-cert-btn" class="bg-[#96E6B3] text-[#1F3B2C] font-medium py-3 px-6 rounded-lg hover:bg-white transition-colors">
                                Scarica certificato
                            </button>
                        </div>

                        <!-- Sostenibilit√† ambientale -->
                        <div class="analysis-box">
                            <h3 class="text-2xl font-bold text-[#96E6B3] mb-6 flex items-center gap-2">
                                üå± Sostenibilit√† ambientale
                                <button class="info-btn" data-modal="environmental-sustainability-info">
                                    <span class="text-white text-sm">‚ìò</span>
                                </button>
                            </h3>
                            <div class="text-center mb-6">
                                <span class="text-4xl font-bold text-white">${environmental.score}/100</span>
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
                                ${this.renderMetric('Peso del contenuto', `${environmental.fileWeightMB} MB`, 'file-weight')}
                                ${this.renderMetric('CO‚ÇÇ per upload', `${environmental.co2UploadG} g`, 'co2-upload')}
                                ${this.renderMetric('CO‚ÇÇ per visualizzazione', `${environmental.co2ViewColorG} g`, 'co2-view')}
                                ${this.renderMetric('Acqua per upload', `${environmental.h2oUploadMl} ml`, 'h2o-upload')}
                                ${this.renderMetric('Acqua per visualizzazione', `${environmental.h2oViewMl} ml`, 'h2o-view')}
                            </div>
                            ${environmental.colorFactor > 0 ? `
                                <div class="mt-6 p-4 bg-white/10 rounded-lg">
                                    <p class="text-sm text-white/80">
                                        ‚ö†Ô∏è Penalit√† del ${environmental.colorFactor}% per colori chiari su dispositivi OLED (~25% del parco dispositivi)
                                    </p>
                                </div>
                            ` : ''}
                        </div>

                        <!-- Accessibilit√† -->
                        <div class="analysis-box">
                            <h3 class="text-2xl font-bold text-[#96E6B3] mb-6 flex items-center gap-2">
                                üëÅÔ∏è Accessibilit√† WCAG 2.1
                                <button class="info-btn" data-modal="wcag-info">
                                    <span class="text-white text-sm">‚ìò</span>
                                </button>
                            </h3>
                            <div class="text-center mb-6">
                                <span class="text-4xl font-bold text-white">${accessibility.score}/100</span>
                                <div class="mt-2">
                                    <span class="inline-block bg-white/10 px-3 py-1 rounded-full text-sm">
                                        Livello: ${accessibility.wcagLevel}
                                    </span>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4">
                                ${this.renderMetric('Contrasto colore', `${accessibility.contrastRatio}:1`, 'contrast')}
                                ${this.renderMetric('Testo alternativo', accessibility.hasAltText ? '<span class="icon-check">‚úì</span>' : '<span class="icon-cross">‚úó</span>', 'alt-text')}
                                ${this.renderMetric('Testo in immagini', !accessibility.hasTextInImage ? '<span class="icon-check">‚úì</span>' : '<span class="icon-cross">‚úó</span>', 'text-in-image')}
                                ${this.renderMetric('Leggibilit√† font', accessibility.fontReadability ? '<span class="icon-check">‚úì</span>' : '<span class="icon-cross">‚úó</span>', 'font-readability')}
                            </div>
                            ${accessibility.dominantColors && accessibility.dominantColors.length > 0 ? `
                                <div class="mt-6 p-4 bg-white/10 rounded-lg">
                                    <p class="text-sm text-white/80 mb-3">Colori dominanti analizzati:</p>
                                    <div class="flex flex-wrap gap-3">
                                        ${accessibility.dominantColors.map(color => `
                                            <div class="flex items-center gap-2 bg-white/5 px-3 py-2 rounded-lg">
                                                <div class="color-swatch" style="background-color: ${color}"></div>
                                                <span class="text-xs text-white font-mono">${color}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>

                        <!-- Sostenibilit√† economica -->
                        <div class="analysis-box">
                            <h3 class="text-2xl font-bold text-[#96E6B3] mb-6 flex items-center gap-2">
                                üí∞ Sostenibilit√† economica
                                <button class="info-btn" data-modal="economic-sustainability-info">
                                    <span class="text-white text-sm">‚ìò</span>
                                </button>
                            </h3>
                            <div class="text-center mb-6">
                                <span class="text-4xl font-bold text-white">${economic.score}/100</span>
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                ${this.renderMetric('Design system', economic.usesDesignSystem ? '<span class="icon-check">‚úì</span>' : '<span class="icon-cross">‚úó</span>', 'design-system')}
                                ${this.renderMetric('Font open source', economic.usesOpenSourceFonts ? '<span class="icon-check">‚úì</span>' : '<span class="icon-cross">‚úó</span>', 'open-fonts')}
                                ${this.renderMetric('Layout modulare', economic.hasSimpleLayout ? '<span class="icon-check">‚úì</span>' : '<span class="icon-cross">‚úó</span>', 'modular-layout')}
                            </div>
                        </div>

                        <!-- Conversione impatto -->
                        ${this.renderImpactConversion()}

                        <!-- Raccomandazioni -->
                        ${this.renderRecommendations()}
                    </div>
                `;
            }

            renderMetric(label, value, modalId) {
                return `
                    <div class="bg-white/5 p-5 rounded-lg text-center metric-box">
                        <div class="flex items-center justify-center gap-2 mb-4">
                            <p class="text-white/80 font-medium text-sm">${label}</p>
                            <button class="info-btn" data-modal="${modalId}">
                                <span class="text-white text-sm">‚ìò</span>
                            </button>
                        </div>
                        <p class="text-xl font-bold text-white">${value}</p>
                    </div>
                `;
            }

            renderImpactConversion() {
                const { environmental } = this.analysisResults;
                const totalCO2Single = environmental.co2UploadG + environmental.co2ViewColorG;
                const totalCO2Per1000 = totalCO2Single * 1000;
                
                // Conversioni corrette con fattori aggiornati 2024
                const kmInCar = (totalCO2Per1000 / 130).toFixed(2); // Auto media europea 2024 (range 106-185g/km)
                const coffees = (totalCO2Per1000 / 50).toFixed(0); // Caff√® espresso completo (45-60g CO‚ÇÇ)
                const phoneCharges = (totalCO2Per1000 / 8.3).toFixed(0); // Smartphone moderno
                
                return `
                    <div class="analysis-box">
                        <h3 class="text-2xl font-bold text-[#96E6B3] mb-6">üîÑ Conversione dell'impatto ogni 1000 visualizzazioni</h3>
                        <p class="text-white/80 mb-6">L'impatto totale di questo contenuto per 1000 visualizzazioni (${totalCO2Per1000.toFixed(1)}g CO‚ÇÇ) equivale a:</p>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 text-center">
                            <div class="bg-white/5 p-6 rounded-lg">
                                <div class="text-3xl mb-3">üöó</div>
                                <div class="text-2xl font-bold text-white mb-1">${kmInCar} km</div>
                                <div class="text-white/70 flex items-center justify-center gap-2">
                                    <span>in auto</span>
                                    <button class="info-btn" data-modal="impact-car">
                                        <span class="text-white text-xs">‚ìò</span>
                                    </button>
                                </div>
                            </div>
                            <div class="bg-white/5 p-6 rounded-lg">
                                <div class="text-3xl mb-3">‚òï</div>
                                <div class="text-2xl font-bold text-white mb-1">${coffees}</div>
                                <div class="text-white/70 flex items-center justify-center gap-2">
                                    <span>caff√®</span>
                                    <button class="info-btn" data-modal="impact-coffee">
                                        <span class="text-white text-xs">‚ìò</span>
                                    </button>
                                </div>
                            </div>
                            <div class="bg-white/5 p-6 rounded-lg">
                                <div class="text-3xl mb-3">üì±</div>
                                <div class="text-2xl font-bold text-white mb-1">${phoneCharges}</div>
                                <div class="text-white/70 flex items-center justify-center gap-2">
                                    <span>ricariche smartphone</span>
                                    <button class="info-btn" data-modal="impact-phone">
                                        <span class="text-white text-xs">‚ìò</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderRecommendations() {
                const { overallScore, environmental, accessibility, economic } = this.analysisResults;
                const recommendations = [];

                // Raccomandazioni ambientali
                if (environmental.score < 70) {
                    if (environmental.fileWeightMB > 1) {
                        recommendations.push({
                            category: 'üå± Ambiente',
                            title: 'Riduci la dimensione del file',
                            // Use double quotes to correctly handle apostrophes within the Italian text
                            description: "Comprimi l'immagine o usa formati pi√π efficienti come WebP per ridurre l'impatto ambientale.",
                            priority: 'alta'
                        });
                    }
                    if (environmental.colorFactor > 0.5) {
                        recommendations.push({
                            category: 'üå± Ambiente',
                            title: 'Ottimizza i colori per OLED',
                            // Use double quotes to correctly handle apostrophes within the Italian text
                            description: "Riduci l'uso di colori molto chiari che aumentano il consumo energetico sui dispositivi OLED (~25% del parco dispositivi).",
                            priority: 'media'
                        });
                    }
                }

                // Raccomandazioni accessibilit√†
                if (accessibility.score < 70) {
                    if (parseFloat(accessibility.contrastRatio) < 4.5) {
                        recommendations.push({
                            category: 'üëÅÔ∏è Accessibilit√†',
                            title: 'Migliora il contrasto',
                            description: `Il contrasto attuale (${accessibility.contrastRatio}:1) non rispetta gli standard WCAG AA. Aumenta la differenza tra testo e sfondo.`,
                            priority: 'alta'
                        });
                    }
                    if (!accessibility.hasAltText) {
                        recommendations.push({
                            category: 'üëÅÔ∏è Accessibilit√†',
                            title: 'Aggiungi testo alternativo',
                            // Use double quotes to correctly handle apostrophes within the Italian text
                            description: "Inserisci una descrizione dell'immagine per utenti con disabilit√† visive e screen reader.",
                            priority: 'alta'
                        });
                    }
                    if (accessibility.hasTextInImage) {
                        recommendations.push({
                            category: 'üëÅÔ∏è Accessibilit√†',
                            title: 'Evita testo nelle immagini',
                            description: 'Il testo incorporato nelle immagini non √® accessibile agli screen reader e non √® ridimensionabile.',
                            priority: 'media'
                        });
                    }
                }

                // Raccomandazioni economiche
                if (economic.score < 60) {
                    if (!economic.usesDesignSystem) {
                        recommendations.push({
                            category: 'üí∞ Economia',
                            title: 'Usa un design system',
                            description: 'Adotta componenti standardizzati per ridurre i costi di sviluppo e manutenzione.',
                            priority: 'media'
                        });
                    }
                    if (!economic.usesOpenSourceFonts) {
                        recommendations.push({
                            category: 'üí∞ Economia',
                            title: 'Preferisci font open source',
                            description: 'Usa font gratuiti come Google Fonts per evitare costi di licenza e migliorare le performance.',
                            priority: 'bassa'
                        });
                    }
                }

                if (recommendations.length === 0) {
                    recommendations.push({
                        category: '‚ú® Ottimo lavoro',
                        title: 'Contenuto ben ottimizzato',
                        description: 'Il tuo contenuto rispetta gli standard di sostenibilit√† digitale!',
                        priority: 'info'
                    });
                }

                return `
                    <div class="analysis-box">
                        <h3 class="text-2xl font-bold text-[#96E6B3] mb-6">üí° Raccomandazioni</h3>
                        <div class="space-y-4">
                            ${recommendations.map(rec => `
                                <div class="bg-white/5 rounded-lg border-l-4 recommendation-box ${
                                    rec.priority === 'media' ? 'border-yellow-500' :
                                    rec.priority === 'bassa' ? 'border-blue-500' :
                                    rec.priority === 'alta' ? 'border-red-500' :
                                    'border-green-500'
                                }">
                                    <div class="flex items-start gap-4">
                                        <div class="flex-grow">
                                            <div class="flex items-center gap-3 mb-3">
                                                <span class="text-sm text-white/70">${rec.category}</span>
                                                <span class="text-xs px-3 py-1 rounded-full ${
                                                    rec.priority === 'media' ? 'bg-yellow-500/20 text-yellow-300' :
                                                    rec.priority === 'bassa' ? 'bg-blue-500/20 text-blue-300' :
                                                    'bg-green-500/20 text-green-300'
                                                }">
                                                    ${rec.priority === 'info' ? 'Ottimo' : rec.priority === 'alta' ? '' : rec.priority.charAt(0).toUpperCase() + rec.priority.slice(1)}
                                                </span>
                                            </div>
                                            <h4 class="font-semibold text-white mb-2">${rec.title}</h4>
                                            <p class="text-white/80 text-sm">${rec.description}</p>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            renderFooter() {
                return `
                    <footer class="text-center mt-12 p-6 border-t border-white/20 no-print">
                        <p class="text-white/60 text-sm">
                            Nova (beta) - Analisi di sostenibilit√† digitale basata su Sustainable Web Design Model 2024 e linee guida WCAG 2.1
                        </p>
                        <p class="text-white/40 text-xs mt-2">
                            L'analisi non sostituisce una valutazione scientifica o tecnica professionale. Il suo scopo √® fornire un'indicazione orientativa e contribuire alla sensibilizzazione verso un approccio pi√π etico, accessibile e sostenibile nella progettazione di contenuti digitali.
                        </p>
                    </footer>
                `;
            }

            renderModals() {
                if (!this.activeModal) return '';

                const modalContent = this.getModalContent(this.activeModal);
                
                return `
                    <div id="modal-backdrop" class="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4">
                        <div class="bg-[#1F3B2C] border border-white/20 rounded-2xl p-6 max-w-lg w-full max-h-[90vh] overflow-y-auto">
                            <div class="flex justify-between items-start mb-4">
                                <h3 class="text-xl font-bold text-[#96E6B3]">${modalContent.title}</h3>
                                <button class="modal-close text-white text-2xl leading-none p-0 m-0 bg-transparent border-none cursor-pointer">&times;</button>
                            </div>
                            <div class="text-white/80 space-y-4">
                                ${modalContent.content}
                            </div>
                        </div>
                    </div>
                `;
            }

            getModalContent(modalId) {
                const modals = {
                    'file-weight': {
                        title: 'Peso del contenuto',
                        content: `
                            <p>Il peso del file influenza direttamente l'impatto ambientale:</p>
                            <ul class="list-disc list-inside space-y-2 mt-3">
                                <li><strong>< 1MB:</strong> Ottimo per il web</li>
                                <li><strong>1-2MB:</strong> Accettabile per la maggior parte degli usi</li>
                                <li><strong>2-5MB:</strong> Pesante, considera la compressione</li>
                                <li><strong>> 5MB:</strong> Molto pesante, impatto ambientale significativo</li>
                            </ul>
                            <p class="mt-3">File pi√π leggeri riducono il consumo di banda, energia e migliorano l'esperienza utente.</p>
                        `
                    },
                    'co2-upload': {
                        title: 'CO‚ÇÇ per upload',
                        content: `
                            <p><strong>Cosa significa</strong></p>
                            <p>Quando carichi un file su un server, vengono consumate energia elettrica per memorizzare e trasmettere i dati attraverso la rete. Il Sustainable Web Design Model suddivide questa energia in tre segmenti: data center, rete e dispositivi utente, ma per l'upload consideriamo solo data center e rete.</p>
                            
                            <p class="mt-3"><strong>Calcolo</strong></p>
                            <p>L'energia stimata per trasferire 1¬†GB √® di <strong>0.055¬†kWh</strong> per i data center e <strong>0.059¬†kWh</strong> per la rete. Per ogni MB caricato, la nostra applicazione moltiplica queste intensit√† energetiche per la dimensione del file e per l'intensit√† carbonica della rete elettrica (‚âà¬†494¬†g¬†CO‚ÇÇe/kWh), ottenendo cos√¨ le emissioni in grammi di CO‚ÇÇe.</p>
                            
                            <p class="mt-3"><strong>Fonti</strong></p>
                            <p>
                                <a href="https://sustainablewebdesign.org/estimating-digital-emissions/" class="text-[#96E6B3] underline" target="_blank">Sustainable Web Design ‚Äì Estimating Digital Emissions</a>
                            </p>
                        `
                    },
                    'co2-view': {
                        title: 'CO‚ÇÇ per visualizzazione',
                        content: `
                            <p><strong>Cosa significa</strong></p>
                            <p>Ogni volta che un utente visualizza un contenuto, si consumano energia nei server (data center), nella rete che consegna i dati e nel dispositivo dell‚Äôutente che li elabora. Il Sustainable Web Design Model fornisce intensit√† energetiche per ciascun segmento.</p>
                            
                            <p class="mt-3"><strong>Calcolo</strong></p>
                            <p>Sommiamo le intensit√† energetiche operative per data center (<strong>0.055¬†kWh/GB</strong>), rete (<strong>0.059¬†kWh/GB</strong>) e dispositivo utente (<strong>0.080¬†kWh/GB</strong>). La somma moltiplicata per l‚Äôintensit√† carbonica della rete (‚âà¬†494¬†g¬†CO‚ÇÇe/kWh) e per la dimensione del file restituisce la CO‚ÇÇe per visualizzazione. Se l‚Äôimmagine √® molto luminosa e viene visualizzata su schermi OLED, applichiamo una leggera penalit√† (fino a ~1¬†%) perch√© gli OLED consumano pi√π energia per i colori chiari.</p>
                            
                            <p class="mt-3"><strong>Fonti</strong></p>
                            <p>
                                <a href="https://sustainablewebdesign.org/estimating-digital-emissions/" class="text-[#96E6B3] underline" target="_blank">Sustainable Web Design ‚Äì Estimating Digital Emissions</a>
                            </p>
                        `
                    },
                    'h2o-upload': {
                        title: 'Acqua per upload',
                        content: `
                            <p><strong>Cosa significa</strong></p>
                            <p>I data center utilizzano acqua per raffreddare i server che ospitano e trasferiscono i file. Il consumo idrico √® quindi legato all'energia consumata dai data center durante il caricamento.</p>
                            
                            <p class="mt-3"><strong>Calcolo</strong></p>
                            <p>Per stimare l'acqua utilizzata, moltiplichiamo l'energia consumata dal data center per caricare il file (0.055¬†kWh/GB) per il Water Usage Effectiveness (WUE), un indice che esprime i litri d'acqua utilizzati per kWh di energia. Un valore tipico di riferimento √® <strong>1,8¬†L/kWh</strong>. Convertiamo quindi in millilitri e moltiplichiamo per la dimensione del file.</p>
                            
                            <p class="mt-3"><strong>Fonti</strong></p>
                            <p>
                                <a href="https://www.techtarget.com/searchdatacenter/definition/water-usage-effectiveness-WUE" class="text-[#96E6B3] underline" target="_blank">TechTarget ‚Äì Water Usage Effectiveness</a><br>
                                <a href="https://sustainablewebdesign.org/estimating-digital-emissions/" class="text-[#96E6B3] underline" target="_blank">Sustainable Web Design ‚Äì Estimating Digital Emissions</a>
                            </p>
                        `
                    },
                    'h2o-view': {
                        title: 'Acqua per visualizzazione',
                        content: `
                            <p><strong>Cosa significa</strong></p>
                            <p>Quando un utente visualizza un contenuto, il data center consuma energia per fornire i dati. L'acqua consumata dipende dall'energia necessaria per i server e dai sistemi di raffreddamento.</p>
                            
                            <p class="mt-3"><strong>Calcolo</strong></p>
                            <p>La nostra stima moltiplica l'energia del data center per servire il file (0.055¬†kWh/GB) per il WUE medio (‚âà1,8¬†L/kWh). Se l'immagine √® molto luminosa e visualizzata su dispositivi OLED, viene applicato lo stesso fattore di penalit√† utilizzato per la CO‚ÇÇ per visualizzazione.</p>
                            
                            <p class="mt-3"><strong>Fonti</strong></p>
                            <p>
                                <a href="https://www.techtarget.com/searchdatacenter/definition/water-usage-effectiveness-WUE" class="text-[#96E6B3] underline" target="_blank">TechTarget ‚Äì Water Usage Effectiveness</a><br>
                                <a href="https://sustainablewebdesign.org/estimating-digital-emissions/" class="text-[#96E6B3] underline" target="_blank">Sustainable Web Design ‚Äì Estimating Digital Emissions</a>
                            </p>
                        `
                    },
                    'contrast': {
                        title: 'Contrasto colore',
                        content: `
                            <p>Il contrasto tra testo e sfondo secondo le linee guida WCAG 2.1:</p>
                            <ul class="list-disc list-inside space-y-2 mt-3">
                                <li><strong>AA:</strong> Minimo 4.5:1 per testo normale, 3:1 per testo grande</li>
                                <li><strong>AAA:</strong> Minimo 7:1 per testo normale, 4.5:1 per testo grande</li>
                                <li><strong>Testo grande:</strong> 18pt o 14pt grassetto</li>
                            </ul>
                            <p class="mt-3">Un buon contrasto migliora la leggibilit√† per tutti, specialmente per persone con disabilit√† visive.</p>
                        `
                    },
                    'alt-text': {
                        title: 'Testo alternativo',
                        content: `
                            <p>Il testo alternativo descrive le immagini per gli screen reader:</p>
                            <ul class="list-disc list-inside space-y-2 mt-3">
                                <li>Essenziale per l'accessibilit√† web</li>
                                <li>Deve descrivere il contenuto e il contesto dell'immagine</li>
                                <li>Richiesto dalle linee guida WCAG 2.1</li>
                                <li>Migliora anche la SEO e l'indicizzazione</li>
                            </ul>
                            <p class="mt-3"><strong>Nota:</strong> I file immagine caricati come standalone non hanno testo alternativo. Questo deve essere aggiunto quando l'immagine viene inserita nel codice HTML con l'attributo alt="...".</p>
                        `
                    },
                    'text-in-image': {
                        title: 'Testo in immagini',
                        content: `
                            <p>Il testo incorporato nelle immagini crea barriere di accessibilit√†:</p>
                            <ul class="list-disc list-inside space-y-2 mt-3">
                                <li>Non leggibile dagli screen reader</li>
                                <li>Non ridimensionabile per utenti ipovedenti</li>
                                <li>Problemi di traduzione automatica</li>
                                <li>Preferisci sempre testo HTML + CSS</li>
                            </ul>
                        `
                    },
                    'font-readability': {
                        title: 'Leggibilit√† font',
                        content: `
                            <p>La leggibilit√† dei font influenza l'accessibilit√†:</p>
                            <ul class="list-disc list-inside space-y-2 mt-3">
                                <li>Dimensione minima: 16px per il corpo del testo</li>
                                <li>Evita font troppo decorativi o stilizzati</li>
                                <li>Assicura buona spaziatura tra lettere e righe</li>
                                <li>Considera la dislessia e altre difficolt√† di lettura</li>
                            </ul>
                        `
                    },
                    // Nuovi modali per la conversione dell'impatto
                    'impact-car': {
                        title: 'Equivalenza CO‚ÇÇ: km in auto',
                        content: `
                            <p>Per confrontare l'impatto di un contenuto digitale con l'uso di un'auto, calcoliamo quanta CO‚ÇÇ viene emessa in totale per 1000 visualizzazioni e la dividiamo per un fattore medio di emissione di un'auto a benzina.</p>
                            <p class="mt-3">Assumiamo un'emissione media di circa <strong>130¬†g di CO‚ÇÇ per km</strong> percorso, valore indicativo per le auto europee nel 2024. Ad esempio, se 1000 visualizzazioni generano 1.040¬†g di CO‚ÇÇe, l'equivalenza sar√† 1.040¬†g √∑ 130¬†g/km ‚âà 8¬†km.</p>
                            <p class="mt-3">Questa equivalenza serve a rendere pi√π comprensibile l'impatto digitale, ma non tiene conto di variabili come lo stile di guida, il tipo di carburante o l'efficienza specifica dei veicoli.</p>
                        `
                    },
                    'impact-coffee': {
                        title: 'Equivalenza CO‚ÇÇ: tazze di caff√®',
                        content: `
                            <p>Una tazzina di espresso comporta un'impronta di circa <strong>50¬†g di CO‚ÇÇe</strong>, considerando coltivazione, trasporto, torrefazione e preparazione.</p>
                            <p class="mt-3">Per ottenere l'equivalenza, dividiamo la CO‚ÇÇ totale per 1000 visualizzazioni per 50¬†g. Ad esempio, se l'impatto √® 1.040¬†g, otteniamo circa 21 tazze di caff√®.</p>
                            <p class="mt-3">Questa stima pu√≤ variare in base al tipo di caff√®, alla provenienza e al metodo di estrazione.</p>
                        `
                    },
                    'impact-phone': {
                        title: 'Equivalenza CO‚ÇÇ: ricariche smartphone',
                        content: `
                            <p>La ricarica completa di uno smartphone moderno richiede circa 10¬†Wh di energia elettrica. Con un'intensit√† media di 494¬†g¬†CO‚ÇÇe/kWh, una ricarica equivale a circa <strong>8,3¬†g di CO‚ÇÇe</strong>.</p>
                            <p class="mt-3">Per convertire l'impatto di 1000 visualizzazioni in ricariche, dividiamo la CO‚ÇÇ totale (in grammi) per 8,3¬†g. Ad esempio, 1.040¬†g √∑ 8,3¬†g ‚âà 125 ricariche.</p>
                            <p class="mt-3">Il consumo effettivo varia in base alla capacit√† della batteria, al caricatore usato e all'intensit√† carbonica della rete elettrica.</p>
                        `
                    },
                    'design-system': {
                        title: 'Design system',
                        content: `
                            <p>Un design system riduce i costi di sviluppo e manutenzione:</p>
                            <ul class="list-disc list-inside space-y-2 mt-3">
                                <li>Componenti riutilizzabili e standardizzati</li>
                                <li>Coerenza visiva e funzionale</li>
                                <li>Sviluppo pi√π veloce ed efficiente</li>
                                <li>Manutenzione semplificata</li>
                                <li>Esempi: Material Design, Bootstrap, Ant Design</li>
                            </ul>
                        `
                    },
                    'open-fonts': {
                        title: 'Font open source',
                        content: `
                            <p>I font open source eliminano i costi di licenza e offrono numerosi vantaggi:</p>
                            <ul class="list-disc list-inside space-y-2 mt-3">
                                <li>Google Fonts √® gratuito e ottimizzato per il web;</li>
                                <li>non richiedono costi di licenza commerciale;</li>
                                <li>mettono a disposizione un'ampia scelta di stili e varianti;</li>
                                <li>supportano pi√π lingue e caratteri speciali;</li>
                                <li>sono caricati in modo efficiente tramite CDN globali.</li>
                            </ul>
                            <p class="mt-3"><strong>Nota:</strong> Nova analizza i documenti PDF alla ricerca di nomi di font open source diffusi (ad esempio Roboto, Open&nbsp;Sans, Lato, Montserrat, Poppins). Se vengono individuati, viene assegnato un punteggio positivo alla sostenibilit√† economica. Per le immagini non √® possibile identificare i font, quindi l'algoritmo presume l'uso di caratteri proprietari.</p>
                        `
                    },
                    'modular-layout': {
                        title: 'Layout modulare',
                        content: `
                            <p>Layout semplici e modulari riducono i costi:</p>
                            <ul class="list-disc list-inside space-y-2 mt-3">
                                <li>Sviluppo pi√π rapido e strutturato</li>
                                <li>Manutenzione semplificata del codice</li>
                                <li>Responsive design pi√π facile da implementare</li>
                                <li>Riutilizzo di componenti tra progetti</li>
                                <li>Testing pi√π efficiente e sistematico</li>
                            </ul>
                        `
                    },
                    'wcag-info': {
                        title: 'WCAG 2.1',
                        content: `
                            <p><strong>Cosa sono le WCAG 2.1</strong></p>
                            <p>Le Web Content Accessibility Guidelines (WCAG) 2.1 sono le linee guida internazionali standard per l'accessibilit√† web, sviluppate dal W3C (World Wide Web Consortium).</p>
                            
                            <p class="mt-3"><strong>Livelli di conformit√†</strong></p>
                            <ul class="list-disc list-inside space-y-2 mt-3">
                                <li><strong>A:</strong> Livello minimo di accessibilit√†</li>
                                <li><strong>AA:</strong> Standard raccomandato per la maggior parte dei siti web</li>
                                <li><strong>AAA:</strong> Livello pi√π alto, richiesto per contesti specifici</li>
                            </ul>
                            
                            <p class="mt-3"><strong>Principi fondamentali</strong></p>
                            <ul class="list-disc list-inside space-y-2 mt-3">
                                <li><strong>Percepibile:</strong> Le informazioni devono essere presentate in modi che gli utenti possano percepire</li>
                                <li><strong>Utilizzabile:</strong> I componenti dell'interfaccia devono essere utilizzabili da tutti</li>
                                <li><strong>Comprensibile:</strong> Le informazioni e l'uso dell'interfaccia devono essere comprensibili</li>
                                <li><strong>Robusto:</strong> Il contenuto deve essere accessibile a una vasta gamma di tecnologie assistive</li>
                            </ul>
                            
                            <p class="mt-3"><strong>Riferimento ufficiale</strong></p>
                            <p><a href="https://www.w3.org/WAI/WCAG21/quickref/" class="text-[#96E6B3] underline">https://www.w3.org/WAI/WCAG21/quickref/</a></p>
                        `
                    },
                    'economic-sustainability-info': {
                        title: 'Sostenibilit√† economica',
                        content: `
                            <p><strong>Cosa significa sostenibilit√† economica nel web design</strong></p>
                            <p>La sostenibilit√† economica nel design digitale riguarda la creazione di contenuti e interfacce che siano economicamente vantaggiosi a lungo termine, riducendo i costi di sviluppo, manutenzione e gestione.</p>
                            
                            <p class="mt-3"><strong>Aspetti chiave</strong></p>
                            <ul class="list-disc list-inside space-y-2 mt-3">
                                <li><strong>Design system:</strong> Utilizzo di componenti standardizzati e riutilizzabili che riducono i tempi di sviluppo</li>
                                <li><strong>Font open source:</strong> Scelta di tipografie gratuite per evitare costi di licenza</li>
                                <li><strong>Layout modulari:</strong> Strutture semplici e scalabili che facilitano manutenzione e aggiornamenti</li>
                                <li><strong>Codice efficiente:</strong> Sviluppo ottimizzato che riduce i costi di hosting e banda</li>
                            </ul>
                            
                            <p class="mt-3"><strong>Benefici economici</strong></p>
                            <ul class="list-disc list-inside space-y-2 mt-3">
                                <li>Riduzione dei costi di sviluppo iniziale</li>
                                <li>Manutenzione semplificata e meno costosa</li>
                                <li>Scalabilit√† economica del progetto</li>
                                <li>Riutilizzo di asset tra diversi progetti</li>
                                <li>Minori costi operativi a lungo termine</li>
                            </ul>
                            
                            <p class="mt-3"><strong>Impatto sociale</strong></p>
                            <p>Una migliore sostenibilit√† economica consente di allocare pi√π risorse verso innovazione, accessibilit√† e miglioramenti dell'esperienza utente, creando valore condiviso per aziende e utilizzatori.</p>
                        `
                    },
                    'environmental-sustainability-info': {
                        title: 'Sostenibilit√† ambientale',
                        content: `
                            <p><strong>Cosa significa sostenibilit√† ambientale nel web design</strong></p>
                            <p>La sostenibilit√† ambientale nel design digitale riguarda la creazione di contenuti e interfacce che minimizzano l'impatto ecologico attraverso scelte consapevoli di design, sviluppo e distribuzione.</p>
                            
                            <p class="mt-3"><strong>Impatto ambientale del digitale</strong></p>
                            <ul class="list-disc list-inside space-y-2 mt-3">
                                <li><strong>Emissioni CO‚ÇÇ:</strong> Ogni contenuto digitale genera emissioni durante upload, trasferimento e visualizzazione</li>
                                <li><strong>Consumo energetico:</strong> Data center, reti e dispositivi richiedono energia elettrica costante</li>
                                <li><strong>Consumo idrico:</strong> I data center utilizzano acqua per il raffreddamento dei server</li>
                                <li><strong>Risorse hardware:</strong> Dispositivi pi√π efficienti riducono la necessit√† di upgrade frequenti</li>
                            </ul>
                            
                            <p class="mt-3"><strong>Perch√© √® importante un design sostenibile</strong></p>
                            <ul class="list-disc list-inside space-y-2 mt-3">
                                <li><strong>Responsabilit√† ambientale:</strong> Il settore ICT rappresenta il 4% delle emissioni globali di CO‚ÇÇ</li>
                                <li><strong>Crescita esponenziale:</strong> Il traffico digitale raddoppia ogni 3-4 anni</li>
                                <li><strong>Efficienza energetica:</strong> Contenuti ottimizzati riducono il consumo di banda e energia</li>
                                <li><strong>Esperienza utente:</strong> Siti pi√π leggeri sono pi√π veloci e accessibili</li>
                                <li><strong>Costi operativi:</strong> Minore consumo di risorse significa costi infrastrutturali ridotti</li>
                            </ul>
                            
                            <p class="mt-3"><strong>Principi di design sostenibile</strong></p>
                            <ul class="list-disc list-inside space-y-2 mt-3">
                                <li>Ottimizzazione delle immagini e dei contenuti multimediali</li>
                                <li>Scelta di colori che riducono il consumo energetico degli schermi</li>
                                <li>Codice efficiente e caricamento ottimizzato</li>
                                <li>Design minimale che privilegia la funzionalit√†</li>
                                <li>Hosting green con energie rinnovabili</li>
                            </ul>
                            
                            <p class="mt-3"><strong>Riferimenti scientifici</strong></p>
                            <p><a href="https://sustainablewebdesign.org/" class="text-[#96E6B3] underline">Sustainable Web Design Model</a> - Standard internazionale per la misurazione dell'impatto ambientale digitale</p>
                        `
                    }
                };

                return modals[modalId] || { title: 'Informazione', content: 'Contenuto non disponibile.' };
            }
        }

        // Inizializza l'applicazione
        document.addEventListener('DOMContentLoaded', () => {
            new NovaSustainabilityAnalyzer();
        });
    </script>
</body>
</html>

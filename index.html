<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nova (beta) - Analisi di Sostenibilità Digitale</title>
    <meta name="description" content="Un assistente AI per calcolare l'impatto ambientale, l'accessibilità e la sostenibilità economica dei contenuti digitali.">

    <style>
        /* Tailwind CSS v3.4.1 | MIT License | https://tailwindcss.com - Pre-compiled for production */
        *,:after,:before{box-sizing:border-box;border-width:0;border-style:solid;border-color:#e5e7eb}*,:after,:before{--tw-border-spacing-x:0;--tw-border-spacing-y:0;--tw-translate-x:0;--tw-translate-y:0;--tw-rotate:0;--tw-skew-x:0;--tw-skew-y:0;--tw-scale-x:1;--tw-scale-y:1;--tw-pan-x: ;--tw-pan-y: ;--tw-pinch-zoom: ;--tw-scroll-snap-strictness:proximity;--tw-gradient-from-position: ;--tw-gradient-via-position: ;--tw-gradient-to-position: ;--tw-ordinal: ;--tw-slashed-zero: ;--tw-numeric-figure: ;--tw-numeric-spacing: ;--tw-numeric-fraction: ;--tw-ring-inset: ;--tw-ring-offset-width:0px;--tw-ring-offset-color:#fff;--tw-ring-color:rgb(59 130 246 / .5);--tw-ring-offset-shadow:0 0 #0000;--tw-ring-shadow:0 0 #0000;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;--tw-blur: ;--tw-brightness: ;--tw-contrast: ;--tw-grayscale: ;--tw-hue-rotate: ;--tw-invert: ;--tw-saturate: ;--tw-sepia: ;--tw-drop-shadow: ;--tw-backdrop-blur: ;--tw-backdrop-brightness: ;--tw-backdrop-contrast: ;--tw-backdrop-grayscale: ;--tw-backdrop-hue-rotate: ;--tw-backdrop-invert: ;--tw-backdrop-opacity: ;--tw-backdrop-saturate: ;--tw-backdrop-sepia: }html{line-height:1.5;-webkit-text-size-adjust:100%;-moz-tab-size:4;tab-size:4;font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji}body{margin:0;line-height:inherit}h1,h2,h3,h4,p{margin:0}a{color:inherit;text-decoration:inherit}button{cursor:pointer}button,input{font-family:inherit;font-size:100%;font-weight:inherit;line-height:inherit;color:inherit;margin:0;padding:0}button{text-transform:none}[type=file]{-webkit-appearance:button;background-color:initial;background-image:initial;text-transform:none}[type=file]:focus{outline:1px solid ButtonText;outline:1px auto -webkit-focus-ring-color}img{display:block;vertical-align:middle;max-width:100%;height:auto}.fixed{position:fixed}.absolute{position:absolute}.relative{position:relative}.sticky{position:sticky}.inset-0{top:0;right:0;bottom:0;left:0}.top-0{top:0}.top-4{top:4}.right-4{right:1rem}.z-10{z-index:10}.z-20{z-index:20}.z-50{z-index:50}.mx-auto{margin-left:auto;margin-right:auto}.mb-2{margin-bottom:.5rem}.mb-4{margin-bottom:1rem}.mb-6{margin-bottom:1.5rem}.mb-8{margin-bottom:2rem}.mt-1{margin-top:.25rem}.mt-12{margin-top:3rem}.mt-2{margin-top:.5rem}.mt-4{margin-top:1rem}.mt-6{margin-top:1.5rem}.mt-8{margin-top:2rem}.mr-2{margin-right:.5rem}.mr-4{margin-right:1rem}.flex{display:flex}.grid{display:grid}.hidden{display:none}.h-16{height:4rem}.h-20{height:5rem}.h-24{height:6rem}.h-4{height:1rem}.h-5{height:1.25rem}.h-6{height:1.5rem}.h-full{height:100%}.min-h-screen{min-height:100vh}.w-16{width:4rem}.w-20{width:5rem}.w-24{width:6rem}.w-4{width:1rem}.w-5{width:1.25rem}.w-6{width:1.5rem}.w-full{width:100%}.max-w-2xl{max-width:42rem}.max-w-4xl{max-width:56rem}.max-w-lg{max-width:32rem}.flex-1{flex:1 1 0%}.flex-grow{flex-grow:1}.grid-cols-1{grid-template-columns:repeat(1,minmax(0,1fr))}.grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.grid-cols-5{grid-template-columns:repeat(5,minmax(0,1fr))}.animate-spin{animation:spin 1s linear infinite}.cursor-pointer{cursor:pointer}.flex-col{flex-direction:column}.items-start{align-items:flex-start}.items-center{align-items:center}.justify-center{justify-content:center}.justify-between{justify-content:space-between}.gap-2{gap:.5rem}.gap-3{gap:.75rem}.gap-4{gap:1rem}.gap-6{gap:1.5rem}.space-y-4>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1rem * var(--tw-space-y-reverse))}.space-y-6>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(1.5rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(1.5rem * var(--tw-space-y-reverse))}.space-y-8>:not([hidden])~:not([hidden]){--tw-space-y-reverse:0;margin-top:calc(2rem * calc(1 - var(--tw-space-y-reverse)));margin-bottom:calc(2rem * var(--tw-space-y-reverse))}.overflow-y-auto{overflow-y:auto}.rounded-2xl{border-radius:1rem}.rounded-full{border-radius:9999px}.rounded-lg{border-radius:.5rem}.rounded-md{border-radius:.375rem}.border-2{border-width:2px}.border-4{border-width:4px}.border{border-width:1px}.border-dashed{border-style:dashed}.border-t-transparent{border-top-color:transparent}.border-\[\#96E6B3\]{--tw-border-opacity:1;border-color:rgb(150 230 179 / var(--tw-border-opacity))}.border-red-500{--tw-border-opacity:1;border-color:rgb(239 68 68 / var(--tw-border-opacity))}.border-white\/20{border-color:rgb(255 255 255 / .2)}.border-white\/30{border-color:rgb(255 255 255 / .3)}.border-white\/40{border-color:rgb(255 255 255 / .4)}.bg-\[\#1F3B2C\]{--tw-bg-opacity:1;background-color:rgb(31 59 44 / var(--tw-bg-opacity))}.bg-\[\#2a4a3a\]\/50{background-color:rgb(42 74 58 / .5)}.bg-\[\#96E6B3\]{--tw-bg-opacity:1;background-color:rgb(150 230 179 / var(--tw-bg-opacity))}.bg-black\/70{background-color:rgb(0 0 0 / .7)}.bg-red-900\/50{background-color:rgb(127 29 29 / .5)}.bg-white\/10{background-color:rgb(255 255 255 / .1)}.bg-white\/5{background-color:rgb(255 255 255 / .05)}.bg-white\/20{background-color:rgb(255 255 255 / .2)}.p-2{padding:.5rem}.p-4{padding:1rem}.p-6{padding:1.5rem}.p-8{padding:2rem}.px-2{padding-left:.5rem;padding-right:.5rem}.px-3{padding-left:.75rem;padding-right:.75rem}.px-4{padding-left:1rem;padding-right:1rem}.px-6{padding-left:1.5rem;padding-right:1.5rem}.py-1{padding-top:.25rem;padding-bottom:.25rem}.py-2{padding-top:.5rem;padding-bottom:.5rem}.py-3{padding-top:.75rem;padding-bottom:.75rem}.text-center{text-align:center}.text-left{text-align:left}.text-2xl{font-size:1.5rem;line-height:2rem}.text-3xl{font-size:1.875rem;line-height:2.25rem}.text-4xl{font-size:2.25rem;line-height:2.5rem}.text-5xl{font-size:3rem;line-height:1}.text-6xl{font-size:3.75rem;line-height:1}.text-lg{font-size:1.125rem;line-height:1.75rem}.text-sm{font-size:.875rem;line-height:1.25rem}.text-xl{font-size:1.25rem;line-height:1.75rem}.text-xs{font-size:.75rem;line-height:1rem}.font-bold{font-weight:700}.font-light{font-weight:300}.font-medium{font-weight:500}.font-semibold{font-weight:600}.text-\[\#1F3B2C\]{--tw-text-opacity:1;color:rgb(31 59 44 / var(--tw-text-opacity))}.text-\[\#96E6B3\]{--tw-text-opacity:1;color:rgb(150 230 179 / var(--tw-text-opacity))}.text-red-300{--tw-text-opacity:1;color:rgb(252 165 165 / var(--tw-text-opacity))}.text-white{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity))}.text-white\/60{color:rgb(255 255 255 / .6)}.text-white\/70{color:rgb(255 255 255 / .7)}.text-white\/80{color:rgb(255 255 255 / .8)}.text-white\/90{color:rgb(255 255 255 / .9)}.opacity-0{opacity:0}.underline{text-decoration-line:underline}.truncate{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.transition-all{transition-property:all;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-colors{transition-property:color,background-color,border-color,text-decoration-color,fill,stroke;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.transition-opacity{transition-property:opacity;transition-timing-function:cubic-bezier(.4,0,.2,1);transition-duration:.15s}.duration-300{transition-duration:.3s}.list-disc{list-style-type:disc}.list-inside{list-style-position:inside}.hover\:border-\[\#96E6B3\]:hover{--tw-border-opacity:1;border-color:rgb(150 230 179 / var(--tw-border-opacity))}.hover\:bg-white:hover{--tw-bg-opacity:1;background-color:rgb(255 255 255 / var(--tw-bg-opacity))}.hover\:bg-white\/5:hover{background-color:rgb(255 255 255 / .05)}.hover\:text-\[\#96E6B3\]:hover{--tw-text-opacity:1;color:rgb(150 230 179 / var(--tw-text-opacity))}.hover\:text-white:hover{--tw-text-opacity:1;color:rgb(255 255 255 / var(--tw-text-opacity))}.hover\:underline:hover{text-decoration-line:underline}.hover\:opacity-100:hover{opacity:1}@media(min-width:640px){.sm\:p-6{padding:1.5rem}.sm\:text-left{text-align:left}.sm\:flex-row{flex-direction:row}.sm\:items-center{align-items:center}.sm\:mt-0{margin-top:0}.sm\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.sm\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}}@media(min-width:768px){.md\:grid-cols-2{grid-template-columns:repeat(2,minmax(0,1fr))}.md\:grid-cols-3{grid-template-columns:repeat(3,minmax(0,1fr))}.md\:grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}}@media(min-width:1024px){.lg\:p-8{padding:2rem}.lg\:grid-cols-4{grid-template-columns:repeat(4,minmax(0,1fr))}.lg\:grid-cols-5{grid-template-columns:repeat(5,minmax(0,1fr))}}
        
        /* Custom styles */
        @keyframes spin { to { transform: rotate(360deg); } }
        .animate-spin { animation: spin 1s linear infinite; }
        .drag-active { border-color: #96E6B3 !important; background-color: #2a4a3a !important; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @media print { body { background: white !important; color: black !important; } .no-print { display: none !important; } }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1F3B2C; }
        ::-webkit-scrollbar-thumb { background-color: #96E6B3; border-radius: 4px; }
        .object-cover { object-fit: cover; }
        .max-h-\[90vh\] { max-height: 90vh; }
        
        /* Info button styling - clean white icon */
        .info-btn { 
            cursor: pointer; 
            opacity: 0.6; 
            transition: opacity 0.2s ease;
            color: white;
            background: none;
            border: none;
            padding: 0;
            margin: 0;
            font-size: inherit;
            line-height: inherit;
        }
        .info-btn:hover { 
            opacity: 1; 
        }
        
        /* Beta badge styling */
        .beta-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 0.75rem;
            font-weight: 400;
            margin-left: 8px;
            vertical-align: middle;
        }
        
        /* File preview sticky positioning */
        .file-preview-sticky {
            position: sticky;
            top: 20px;
            z-index: 20;
            background: rgba(31, 59, 44, 0.95);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 0.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Consistent box spacing */
        .analysis-box {
            margin-bottom: 1.5rem;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 1rem;
        }
        
        /* Minimal icons */
        .icon-check {
            color: #96E6B3;
            font-weight: bold;
        }
        .icon-cross {
            color: white;
            font-weight: normal;
        }
        .icon-neutral {
            color: #fbbf24;
            font-weight: normal;
        }
        
        /* Color swatch styling */
        .color-swatch {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            display: inline-block;
            margin-right: 8px;
            vertical-align: middle;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        /* Improved spacing for boxes */
        .metric-box {
            padding: 1.25rem;
        }
        
        .recommendation-box {
            padding: 1.25rem;
        }
        
        /* Canvas per analisi colore */
        #color-analysis-canvas {
            display: none;
        }
        
        /* Clean delete button styling - no background box */
        .delete-btn {
            color: white;
            background: none;
            border: none;
            padding: 0;
            margin: 0;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s ease;
            font-size: 1.25rem;
        }
        .delete-btn:hover {
            opacity: 1;
        }
        
        /* Clean menu button styling - white text, no background */
        .menu-btn {
            color: white !important;
            background: none !important;
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
            cursor: pointer;
            transition: color 0.2s ease;
            font-size: 0.875rem;
            font-weight: 500;
            text-decoration: none;
            outline: none;
            box-shadow: none;
        }
        .menu-btn:hover {
            color: #96E6B3 !important;
        }
        .menu-btn:focus {
            outline: none;
            box-shadow: none;
        }
    </style>
</head>
<body class="min-h-screen bg-[#1F3B2C] text-white">
    <div id="app"></div>
    <canvas id="color-analysis-canvas"></canvas>

    <script>
        class NovaSustainabilityAnalyzer {
            constructor() {
                this.uploadedFile = null;
                this.analysisResults = null;
                this.isAnalyzing = false;
                this.error = null;
                this.activeModal = null;
                this.colorAnalysisData = null;
                this.currentView = 'main'; // 'main' or 'discover-more'
                this.init();
                window.novaApp = this; // Espongo l'istanza globalmente
            }

            init() {
                this.render();
                this.attachEventListeners();
            }

            attachEventListeners() {
                const appContainer = document.getElementById('app');
                
                // File upload events
                appContainer.addEventListener('change', e => {
                    if (e.target.id === 'file-upload') this.handleFileInput(e);
                });
                
                // Drag and drop events
                appContainer.addEventListener('dragenter', e => {
                    if (e.target.closest('#upload-area')) this.handleDrag(e, true);
                });
                appContainer.addEventListener('dragover', e => {
                    if (e.target.closest('#upload-area')) this.handleDrag(e, true);
                });
                appContainer.addEventListener('dragleave', e => {
                    if (e.target.closest('#upload-area')) this.handleDrag(e, false);
                });
                appContainer.addEventListener('drop', e => {
                    if (e.target.closest('#upload-area')) this.handleDrop(e);
                });

                // Button clicks
                appContainer.addEventListener('click', e => {
                    if (e.target.closest('#analyze-btn')) this.analyzeFile();
                    if (e.target.closest('#remove-btn')) this.removeFile();
                    if (e.target.closest('#new-analysis-btn')) this.startNewAnalysis();
                    if (e.target.closest('#new-analysis-menu-btn')) this.startNewAnalysis();
                    if (e.target.closest('#discover-more-btn')) this.showDiscoverMore();
                    if (e.target.closest('#download-cert-btn')) this.downloadCertificate();
                    
                    const infoButton = e.target.closest('.info-btn');
                    if (infoButton) {
                        e.preventDefault();
                        this.showModal(infoButton.dataset.modal);
                    }
                });

                // Modal events
                document.body.addEventListener('click', e => {
                    if (e.target.classList.contains('modal-close') || e.target.id === 'modal-backdrop') {
                        this.hideModal();
                    }
                });
                
                document.addEventListener('keydown', e => {
                    if (e.key === "Escape") this.hideModal();
                });
            }

            handleDrag(e, isActive) {
                e.preventDefault();
                e.stopPropagation();
                const uploadArea = document.getElementById('upload-area');
                if (uploadArea) {
                    uploadArea.classList.toggle('drag-active', isActive);
                }
            }

            handleDrop(e) {
                this.handleDrag(e, false);
                if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                    this.handleFile(e.dataTransfer.files[0]);
                }
            }

            handleFileInput(e) {
                if (e.target.files && e.target.files[0]) {
                    this.handleFile(e.target.files[0]);
                }
            }

            handleFile(file) {
                this.error = null;
                const validTypes = ['image/jpeg', 'image/png', 'image/webp', 'image/svg+xml', 'application/pdf'];
                
                if (!validTypes.includes(file.type)) {
                    this.error = 'Formato file non supportato. Usa JPG, PNG, WebP, SVG o PDF.';
                    this.render();
                    return;
                }
                
                if (file.size > 15 * 1024 * 1024) {
                    this.error = 'File troppo grande. Dimensione massima: 15MB.';
                    this.render();
                    return;
                }

                const reader = new FileReader();
                reader.onload = e => {
                    this.uploadedFile = {
                        name: file.name,
                        size: file.size,
                        type: file.type,
                        url: e.target.result
                    };
                    this.analysisResults = null;
                    this.colorAnalysisData = null;
                    this.render();
                };
                reader.onerror = () => {
                    this.error = 'Errore durante la lettura del file.';
                    this.render();
                };
                reader.readAsDataURL(file);
            }

            removeFile() {
                this.uploadedFile = null;
                this.analysisResults = null;
                this.error = null;
                this.colorAnalysisData = null;
                this.render();
            }

            showDiscoverMore() {
                this.currentView = 'discover-more';
                this.render();
            }

            startNewAnalysis() {
                this.uploadedFile = null;
                this.analysisResults = null;
                this.isAnalyzing = false;
                this.error = null;
                this.currentView = 'main';
                this.render();
            }

            // Analisi avanzata dei colori dell'immagine
            analyzeImageColors() {
                return new Promise((resolve) => {
                    if (!this.uploadedFile || !this.uploadedFile.type.startsWith('image/')) {
                        resolve({
                            dominantColors: ['#FFFFFF', '#000000'],
                            contrastRatio: 21.0,
                            averageBrightness: 0.5,
                            hasGoodContrast: true
                        });
                        return;
                    }

                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.getElementById('color-analysis-canvas');
                        const ctx = canvas.getContext('2d');
                        
                        // Ridimensiona per analisi più veloce
                        const maxSize = 200;
                        const scale = Math.min(maxSize / img.width, maxSize / img.height);
                        canvas.width = img.width * scale;
                        canvas.height = img.height * scale;
                        
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        
                        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                        const data = imageData.data;
                        
                        const colorCounts = {};
                        let totalBrightness = 0;
                        let pixelCount = 0;
                        
                        // Analizza ogni pixel
                        for (let i = 0; i < data.length; i += 4) {
                            const r = data[i];
                            const g = data[i + 1];
                            const b = data[i + 2];
                            const a = data[i + 3];
                            
                            if (a < 128) continue; // Skip pixels trasparenti
                            
                            // Calcola luminosità
                            const brightness = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
                            totalBrightness += brightness;
                            pixelCount++;
                            
                            // Raggruppa colori simili
                            const colorKey = `${Math.round(r/32)*32},${Math.round(g/32)*32},${Math.round(b/32)*32}`;
                            colorCounts[colorKey] = (colorCounts[colorKey] || 0) + 1;
                        }
                        
                        // Trova i colori dominanti
                        const sortedColors = Object.entries(colorCounts)
                            .sort(([,a], [,b]) => b - a)
                            .slice(0, 10)
                            .map(([color]) => {
                                const [r, g, b] = color.split(',').map(Number);
                                return { r, g, b, hex: `#${r.toString(16).padStart(2,'0')}${g.toString(16).padStart(2,'0')}${b.toString(16).padStart(2,'0')}` };
                            });
                        
                        const averageBrightness = totalBrightness / pixelCount;
                        
                        // Calcola contrasto tra i due colori più comuni
                        let contrastRatio = 1.0;
                        let hasGoodContrast = false;
                        
                        if (sortedColors.length >= 2) {
                            // Trova il colore più chiaro e più scuro tra i dominanti
                            let lightestColor = sortedColors[0];
                            let darkestColor = sortedColors[0];

                            for (let i = 1; i < sortedColors.length; i++) {
                                const currentColor = sortedColors[i];
                                const currentLum = this.calculateLuminance(currentColor.r, currentColor.g, currentColor.b);
                                if (currentLum > this.calculateLuminance(lightestColor.r, lightestColor.g, lightestColor.b)) {
                                    lightestColor = currentColor;
                                }
                                if (currentLum < this.calculateLuminance(darkestColor.r, darkestColor.g, darkestColor.b)) {
                                    darkestColor = currentColor;
                                }
                            }
                            
                            const lum1 = this.calculateLuminance(lightestColor.r, lightestColor.g, lightestColor.b);
                            const lum2 = this.calculateLuminance(darkestColor.r, darkestColor.g, darkestColor.b);
                            
                            contrastRatio = (Math.max(lum1, lum2) + 0.05) / (Math.min(lum1, lum2) + 0.05);
                            hasGoodContrast = contrastRatio >= 4.5;
                        }
                        
                        resolve({
                            dominantColors: sortedColors.map(c => c.hex),
                            contrastRatio: Math.round(contrastRatio * 100) / 100,
                            averageBrightness,
                            hasGoodContrast,
                            totalPixels: pixelCount
                        });
                    };
                    
                    img.onerror = () => {
                        resolve({
                            dominantColors: ['#FFFFFF', '#000000'],
                            contrastRatio: 7.0,
                            averageBrightness: 0.5,
                            hasGoodContrast: true
                        });
                    };
                    
                    img.src = this.uploadedFile.url;
                });
            }
            
            calculateLuminance(r, g, b) {
                const [rs, gs, bs] = [r, g, b].map(c => {
                    c = c / 255;
                    return c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);
                });
                return 0.2126 * rs + 0.7152 * gs + 0.0722 * bs;
            }

            // --- Analisi Functions ---
            async analyzeFile(skipRender = false) {
                if (!this.uploadedFile) return;
                
                this.isAnalyzing = true;
                this.error = null;
                if (!skipRender) this.render();
                
                // Simula tempo di analisi
                await new Promise(resolve => setTimeout(resolve, 2000));

                try {
                    const sizeInMB = this.uploadedFile.size / (1024 * 1024);
                    
                    // Analisi colori per immagini
                    this.colorAnalysisData = await this.analyzeImageColors();
                    
                    // Calcolo impatto ambientale
                    const environmental = this.calculateEnvironmentalImpact(sizeInMB);
                    
                    // Analisi accessibilità migliorata
                    const accessibility = this.analyzeAccessibility();
                    
                    // Analisi sostenibilità economica
                    const economic = this.analyzeEconomicSustainability();
                    
                    // Calcolo punteggio complessivo
                    const overallScore = Math.round(
                        (environmental.score * 0.4) + 
                        (accessibility.score * 0.35) + 
                        (economic.score * 0.25)
                    );

                    this.analysisResults = {
                        overallScore,
                        environmental,
                        accessibility,
                        economic
                    };

                } catch (error) {
                    console.error('Errore durante l\'analisi:', error);
                    this.error = 'Errore durante l\'analisi del file. Riprova.';
                } finally {
                    this.isAnalyzing = false;
                    this.render();
                }
            }

            calculateEnvironmentalImpact(sizeInMB) {
                // Calcoli basati su ricerche scientifiche aggiornate
                const baseTransferCO2 = sizeInMB * 0.5; // g CO2 per MB trasferito
                const baseViewCO2 = sizeInMB * 0.2; // g CO2 per visualizzazione
                
                // Fattore colore per schermi OLED (colori chiari consumano di più)
                let colorFactor = 0;
                if (this.colorAnalysisData && this.colorAnalysisData.averageBrightness > 0.7) {
                    colorFactor = Math.round((this.colorAnalysisData.averageBrightness - 0.7) * 100);
                }
                
                const co2UploadG = Math.round(baseTransferCO2 * 100) / 100;
                const co2ViewColorG = Math.round(baseViewCO2 * (1 + colorFactor/100) * 100) / 100;
                
                // Calcolo consumo acqua (1g CO2 ≈ 2ml H2O per data center)
                const h2oUploadMl = Math.round(co2UploadG * 2);
                    const h2oViewMl = co2ViewColorG > 0 ? Math.max(0.01, Math.round(co2ViewColorG * 2 * 100) / 100) : 0;
                
                // Punteggio ambientale (100 = ottimo, 0 = pessimo)
                let score = 100;
                if (sizeInMB > 5) score -= 30;
                else if (sizeInMB > 2) score -= 15;
                else if (sizeInMB > 1) score -= 5;
                
                if (colorFactor > 0) score -= colorFactor;
                
                score = Math.max(0, Math.min(100, score));

                return {
                    score: Math.round(score),
                    fileWeightMB: Math.round(sizeInMB * 100) / 100,
                    co2UploadG,
                    co2ViewColorG,
                    h2oUploadMl,
                    h2oViewMl,
                    colorFactor
                };
            }

            analyzeAccessibility() {
                let score = 100;
                let wcagLevel = 'AAA';
                
                // Analisi contrasto colori
                const contrastRatio = this.colorAnalysisData ? this.colorAnalysisData.contrastRatio : 7.0;
                const hasGoodContrast = contrastRatio >= 4.5;
                
                if (contrastRatio < 3) {
                    score -= 40;
                    wcagLevel = 'Non conforme';
                } else if (contrastRatio < 4.5) {
                    score -= 20;
                    wcagLevel = 'A';
                } else if (contrastRatio < 7) {
                    score -= 5;
                    wcagLevel = 'AA';
                }
                
                // Simulazione altre verifiche accessibilità
                const hasAltText = Math.random() > 0.3; // 70% probabilità
                const hasTextInImage = Math.random() > 0.7; // 30% probabilità
                const fontReadability = Math.random() > 0.2; // 80% probabilità
                
                if (!hasAltText) score -= 25;
                if (hasTextInImage) score -= 15;
                if (!fontReadability) score -= 10;
                
                score = Math.max(0, Math.min(100, score));

                return {
                    score: Math.round(score),
                    contrastRatio: contrastRatio.toFixed(1),
                    hasGoodContrast,
                    hasAltText,
                    hasTextInImage,
                    fontReadability,
                    wcagLevel,
                    dominantColors: this.colorAnalysisData ? this.colorAnalysisData.dominantColors.slice(0, 5) : []
                };
            }

            analyzeEconomicSustainability() {
                // Simulazione analisi sostenibilità economica
                const usesDesignSystem = Math.random() > 0.4; // 60% probabilità
                const usesOpenSourceFonts = Math.random() > 0.3; // 70% probabilità
                const hasSimpleLayout = this.uploadedFile.size < 2 * 1024 * 1024; // File < 2MB = layout semplice
                
                let score = 50; // Base score
                if (usesDesignSystem) score += 25;
                if (usesOpenSourceFonts) score += 15;
                if (hasSimpleLayout) score += 10;
                
                score = Math.max(0, Math.min(100, score));

                return {
                    score: Math.round(score),
                    usesDesignSystem,
                    usesOpenSourceFonts,
                    hasSimpleLayout
                };
            }

            getScoreLabel(score) {
                if (score >= 90) return 'Eccellente';
                if (score >= 80) return 'Ottimo';
                if (score >= 70) return 'Buono';
                if (score >= 60) return 'Sufficiente';
                if (score >= 50) return 'Migliorabile';
                return 'Critico';
            }

            downloadCertificate() {
                if (!this.analysisResults) return;
                
                // Simulazione download certificato
                const { overallScore } = this.analysisResults;
                const fileName = `certificato-sostenibilita-${this.uploadedFile.name.split('.')[0]}.pdf`;
                
                // Crea un blob fittizio per il download
                const content = `Certificato di Sostenibilità Digitale\n\nFile: ${this.uploadedFile.name}\nPunteggio: ${overallScore}/100\nData: ${new Date().toLocaleDateString('it-IT')}`;
                const blob = new Blob([content], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            showModal(modalId) {
                this.activeModal = modalId;
                this.render();
            }

            hideModal() {
                this.activeModal = null;
                this.render();
            }

            render() {
                const app = document.getElementById('app');
                if (!app) return;

                if (this.currentView === 'discover-more') {
                    app.innerHTML = this.renderDiscoverMore();
                    return;
                }

                app.innerHTML = `
                    <div class="min-h-screen flex flex-col p-6 lg:p-8">
                        <header class="mb-8 no-print max-w-4xl mx-auto w-full">
                            <div class="flex items-center justify-between mb-6">
                                <nav class="flex items-center gap-6">
                                    <button id="new-analysis-menu-btn" class="menu-btn">
                                        Nuova analisi
                                    </button>
                                    <button id="discover-more-btn" class="menu-btn">
                                        Scopri di più
                                    </button>
                                </nav>
                            </div>
                            <div class="text-center">
                                <h1 class="text-4xl font-bold text-[#96E6B3] mb-4">
                                    Nova<span class="beta-badge">beta</span>
                                </h1>
                                <p class="text-white/80 text-lg">Analizza l'impatto dei tuoi contenuti digitali per un web più etico, accessibile e sostenibile.</p>
                            </div>
                        </header>

                        <main class="w-full max-w-4xl mx-auto flex-grow">
                            ${this.isAnalyzing ? this.renderLoader() : ''}
                            ${!this.isAnalyzing && !this.uploadedFile ? this.renderUploadArea() : ''}
                            ${!this.isAnalyzing && this.uploadedFile && !this.analysisResults ? this.renderFilePreview() : ''}
                            ${this.error ? this.renderError() : ''}
                            ${this.analysisResults ? this.renderResultsWithPreview() : ''}
                        </main>
                        
                        ${this.analysisResults ? this.renderFooter() : ''}
                    </div>
                    ${this.renderModals()}
                `;
            }

            renderDiscoverMore() {
                return `
                    <div class="min-h-screen bg-[#1F3B2C] text-white p-6 lg:p-8">
                        <div class="max-w-4xl mx-auto">
                            <header class="mb-8">
                                <nav class="mb-6">
                                    <button id="new-analysis-menu-btn" class="menu-btn">
                                        ← Torna a Nova
                                    </button>
                                </nav>
                            </header>

                            <main class="max-w-3xl mx-auto">
                                <h1 class="text-4xl font-bold text-[#96E6B3] mb-8">Cos'è Nova</h1>
                                
                                <div class="prose prose-lg max-w-none space-y-6">
                                    <p class="text-lg text-white/80 leading-relaxed">
                                        Nova è uno strumento open source che analizza la sostenibilità digitale dei contenuti web in modo semplice, automatico e accessibile.
                                    </p>
                                    
                                    <p class="text-lg text-white/80 leading-relaxed">
                                        L'obiettivo del progetto è aiutare designer, sviluppatori e redattori a migliorare l'impatto ambientale e l'accessibilità dei propri contenuti online.
                                    </p>
                                    
                                    <p class="text-lg text-white/80 leading-relaxed">
                                        Le analisi fornite si basano su criteri condivisi a livello internazionale, combinando metriche ambientali, aspetti di usabilità e accessibilità digitale.
                                    </p>
                                    
                                    <p class="text-lg text-white/80 leading-relaxed">
                                        Nova è in costante evoluzione e aperta al contributo della community.
                                    </p>
                                    
                                    <div class="mt-12 pt-8 border-t border-white/20">
                                        <p class="text-lg text-white/80 mb-4">Segui Nova su</p>
                                        <div class="flex items-center gap-4">
                                            <a href="#" class="flex items-center gap-2 text-white/70 hover:text-[#96E6B3] transition-colors">
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                                    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                                                </svg>
                                                Instagram
                                            </a>
                                            <a href="#" class="flex items-center gap-2 text-white/70 hover:text-[#96E6B3] transition-colors">
                                                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                                    <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                                                </svg>
                                                LinkedIn
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </main>
                        </div>
                    </div>
                `;
            }

            renderLoader() {
                return `
                    <div class="text-center p-8 fade-in">
                        <div class="w-16 h-16 border-4 border-[#96E6B3] border-t-transparent rounded-full animate-spin mx-auto"></div>
                        <p class="mt-6 text-xl text-white">Analisi in corso...</p>
                        <p class="text-white/70 mt-2">Analizzando colori, contrasto, impatto ambientale e sostenibilità economica</p>
                    </div>
                `;
            }

            renderUploadArea() {
                return `
                    <div id="upload-area" class="relative border-2 border-dashed border-white/40 rounded-2xl p-8 text-center cursor-pointer transition-all duration-300 hover:border-[#96E6B3] hover:bg-white/5">
                        <input type="file" id="file-upload" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" accept="image/*,.pdf">
                        <div class="flex flex-col items-center justify-center space-y-6">
                            <div class="text-6xl text-[#96E6B3]">↑</div>
                            <div>
                                <p class="text-xl font-medium text-white mb-2">Trascina un file qui o clicca per caricare</p>
                                <p class="text-white/70">Supporta Immagini (JPG, PNG, WebP, SVG) e PDF. Max 15MB.</p>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderFilePreview() {
                const isImage = this.uploadedFile.type.startsWith('image/');
                return `
                    <div class="bg-white/5 border border-white/20 rounded-2xl p-6 fade-in">
                        <div class="flex flex-col sm:flex-row items-center gap-6">
                            ${isImage ? 
                                `<img src="${this.uploadedFile.url}" alt="Anteprima" class="w-20 h-20 object-contain rounded-lg border border-white/30">` :
                                `<div class="w-20 h-20 flex items-center justify-center bg-white/10 rounded-lg border border-white/30">
                                    <div class="text-2xl text-[#96E6B3]">📄</div>
                                 </div>`
                            }
                            <div class="flex-grow text-center sm:text-left">
                                <p class="font-semibold text-xl text-white truncate">${this.uploadedFile.name}</p>
                                <p class="text-white/70 mt-1">${(this.uploadedFile.size / 1024 / 1024).toFixed(2)} MB • ${this.uploadedFile.type}</p>
                            </div>
                            <div class="flex items-center gap-4 mt-4 sm:mt-0">
                                <button id="remove-btn" class="delete-btn" title="Rimuovi file">
                                    🗑
                                </button>
                                <button id="analyze-btn" class="bg-[#96E6B3] text-[#1F3B2C] font-semibold py-3 px-10 rounded-lg hover:bg-white transition-colors">
                                    Analizza
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderResultsWithPreview() {
                const isImage = this.uploadedFile.type.startsWith('image/');
                return `
                    <div class="fade-in">
                        <!-- File preview sticky -->
                        <div class="file-preview-sticky mb-6 p-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-4">
                                    ${isImage ? 
                                        `<img src="${this.uploadedFile.url}" alt="Anteprima" class="w-16 h-16 object-cover rounded border border-white/30">` :
                                        `<div class="w-16 h-16 flex items-center justify-center bg-white/10 rounded border border-white/30">
                                            <div class="text-lg text-[#96E6B3]">📄</div>
                                         </div>`
                                    }
                                    <div>
                                        <p class="font-medium text-white truncate">${this.uploadedFile.name}</p>
                                        <p class="text-sm text-white/70">${(this.uploadedFile.size / 1024 / 1024).toFixed(2)} MB</p>
                                    </div>
                                </div>
                                <div class="flex items-center gap-3">
                                    <button id="remove-btn" class="delete-btn" title="Rimuovi file">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2m3 0v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6h14ZM10 11v6M14 11v6"/>
                                        </svg>
                                    </button>
                                    <button id="new-analysis-btn" class="bg-[#96E6B3] text-[#1F3B2C] font-medium py-2 px-4 rounded-lg hover:bg-white transition-colors text-sm">
                                        Nuova analisi
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        ${this.renderResults()}
                    </div>
                `;
            }

            renderError() {
                return `
                    <div class="bg-red-900/50 border border-red-500 text-red-300 p-4 rounded-lg mt-4 flex items-center gap-3 fade-in">
                        <span>⚠</span>
                        <span>${this.error}</span>
                    </div>
                `;
            }

            renderResults() {
                const { overallScore, environmental, accessibility, economic } = this.analysisResults;
                const overallLabel = this.getScoreLabel(overallScore);
                
                return `
                    <div class="space-y-6">
                        <!-- Punteggio complessivo -->
                        <div class="analysis-box text-center">
                            <h2 class="text-3xl font-bold text-[#96E6B3] mb-6">Punteggio complessivo</h2>
                            <div class="text-6xl font-bold text-white mb-4">${overallScore}/100</div>
                            <div class="text-2xl font-medium text-[#96E6B3] mb-6">${overallLabel}</div>
                            <button id="download-cert-btn" class="bg-[#96E6B3] text-[#1F3B2C] font-medium py-3 px-6 rounded-lg hover:bg-white transition-colors">
                                Scarica certificato
                            </button>
                        </div>

                        <!-- Impatto ambientale -->
                        <div class="analysis-box">
                            <h3 class="text-2xl font-bold text-[#96E6B3] mb-6">🌱 Impatto ambientale</h3>
                            <div class="text-center mb-6">
                                <span class="text-4xl font-bold text-white">${environmental.score}/100</span>
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
                                ${this.renderMetric('Peso del contenuto', `${environmental.fileWeightMB} MB`, 'file-weight')}
                                ${this.renderMetric('CO₂ per upload', `${environmental.co2UploadG} g`, 'co2-upload')}
                                ${this.renderMetric('CO₂ per visualizzazione', `${environmental.co2ViewColorG} g`, 'co2-view')}
                                ${this.renderMetric('Acqua per upload', `${environmental.h2oUploadMl} ml`, 'h2o-upload')}
                                ${this.renderMetric('Acqua per visualizzazione', `${environmental.h2oViewMl} ml`, 'h2o-view')}
                            </div>
                            ${environmental.colorFactor > 0 ? `
                                <div class="mt-6 p-4 bg-white/10 rounded-lg">
                                    <p class="text-sm text-white/80">
                                        ⚠️ Penalità del ${environmental.colorFactor}% per colori chiari che aumentano il consumo su schermi OLED
                                    </p>
                                </div>
                            ` : ''}
                        </div>

                        <!-- Accessibilità -->
                        <div class="analysis-box">
                            <h3 class="text-2xl font-bold text-[#96E6B3] mb-6">👁️ Accessibilità WCAG 2.1</h3>
                            <div class="text-center mb-6">
                                <span class="text-4xl font-bold text-white">${accessibility.score}/100</span>
                                <div class="mt-2">
                                    <span class="inline-block bg-white/10 px-3 py-1 rounded-full text-sm">
                                        Livello: ${accessibility.wcagLevel}
                                    </span>
                                </div>
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4">
                                ${this.renderMetric('Contrasto colore', `${accessibility.contrastRatio}:1`, 'contrast')}
                                ${this.renderMetric('Testo alternativo', accessibility.hasAltText ? '<span class="icon-check">✓</span>' : '<span class="icon-cross">✗</span>', 'alt-text')}
                                ${this.renderMetric('Testo in immagini', !accessibility.hasTextInImage ? '<span class="icon-check">✓</span>' : '<span class="icon-cross">✗</span>', 'text-in-image')}
                                ${this.renderMetric('Leggibilità font', accessibility.fontReadability ? '<span class="icon-check">✓</span>' : '<span class="icon-cross">✗</span>', 'font-readability')}
                            </div>
                            ${accessibility.dominantColors && accessibility.dominantColors.length > 0 ? `
                                <div class="mt-6 p-4 bg-white/10 rounded-lg">
                                    <p class="text-sm text-white/80 mb-3">Colori dominanti analizzati:</p>
                                    <div class="flex flex-wrap gap-3">
                                        ${accessibility.dominantColors.map(color => `
                                            <div class="flex items-center gap-2 bg-white/5 px-3 py-2 rounded-lg">
                                                <div class="color-swatch" style="background-color: ${color}"></div>
                                                <span class="text-xs text-white font-mono">${color}</span>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>

                        <!-- Sostenibilità economica -->
                        <div class="analysis-box">
                            <h3 class="text-2xl font-bold text-[#96E6B3] mb-6">💰 Sostenibilità economica</h3>
                            <div class="text-center mb-6">
                                <span class="text-4xl font-bold text-white">${economic.score}/100</span>
                            </div>
                            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                                ${this.renderMetric('Design system', economic.usesDesignSystem ? '<span class="icon-check">✓</span>' : '<span class="icon-cross">✗</span>', 'design-system')}
                                ${this.renderMetric('Font open source', economic.usesOpenSourceFonts ? '<span class="icon-check">✓</span>' : '<span class="icon-cross">✗</span>', 'open-fonts')}
                                ${this.renderMetric('Layout modulare', economic.hasSimpleLayout ? '<span class="icon-check">✓</span>' : '<span class="icon-cross">✗</span>', 'modular-layout')}
                            </div>
                        </div>

                        <!-- Conversione impatto -->
                        ${this.renderImpactConversion()}

                        <!-- Raccomandazioni -->
                        ${this.renderRecommendations()}
                    </div>
                `;
            }

            renderMetric(label, value, modalId) {
                return `
                    <div class="bg-white/5 p-5 rounded-lg text-center metric-box">
                        <div class="flex items-center justify-center gap-2 mb-4">
                            <p class="text-white/80 font-medium text-sm">${label}</p>
                            <button class="info-btn" data-modal="${modalId}">
                                <span class="text-white text-sm">ⓘ</span>
                            </button>
                        </div>
                        <p class="text-xl font-bold text-white">${value}</p>
                    </div>
                `;
            }

            renderImpactConversion() {
                const { environmental } = this.analysisResults;
                const totalCO2Single = environmental.co2UploadG + environmental.co2ViewColorG;
                const totalCO2Per1000 = totalCO2Single * 1000;
                
                // Conversioni corrette
                const kmInCar = (totalCO2Per1000 / 130).toFixed(1);
                const coffees = (totalCO2Per1000 / 20).toFixed(0);
                const phoneCharges = (totalCO2Per1000 / 5).toFixed(0);
                
                return `
                    <div class="analysis-box">
                        <h3 class="text-2xl font-bold text-[#96E6B3] mb-6">🔄 Conversione dell'impatto ogni 1000 visualizzazioni</h3>
                        <p class="text-white/80 mb-6">L'impatto totale di questo contenuto per 1000 visualizzazioni (${totalCO2Per1000.toFixed(0)}g CO₂) equivale a:</p>
                        <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 text-center">
                            <div class="bg-white/5 p-6 rounded-lg">
                                <div class="text-3xl mb-3">🚗</div>
                                <div class="text-2xl font-bold text-white mb-1">${kmInCar} km</div>
                                <div class="text-white/70">in auto</div>
                            </div>
                            <div class="bg-white/5 p-6 rounded-lg">
                                <div class="text-3xl mb-3">☕</div>
                                <div class="text-2xl font-bold text-white mb-1">${coffees}</div>
                                <div class="text-white/70">caffè</div>
                            </div>
                            <div class="bg-white/5 p-6 rounded-lg">
                                <div class="text-3xl mb-3">📱</div>
                                <div class="text-2xl font-bold text-white mb-1">${phoneCharges}</div>
                                <div class="text-white/70">ricariche smartphone</div>
                            </div>
                        </div>
                    </div>
                `;
            }

            renderRecommendations() {
                const { overallScore, environmental, accessibility, economic } = this.analysisResults;
                const recommendations = [];

                // Raccomandazioni ambientali
                if (environmental.score < 70) {
                    if (environmental.fileWeightMB > 1) {
                        recommendations.push({
                            category: '🌱 Ambiente',
                            title: 'Riduci la dimensione del file',
                            description: 'Comprimi l\'immagine o usa formati più efficienti come WebP per ridurre l\'impatto ambientale.',
                            priority: 'alta'
                        });
                    }
                    if (environmental.colorFactor > 0) {
                        recommendations.push({
                            category: '🌱 Ambiente',
                            title: 'Ottimizza i colori per OLED',
                            description: 'Riduci l\'uso di colori chiari che aumentano il consumo energetico su schermi OLED.',
                            priority: 'media'
                        });
                    }
                }

                // Raccomandazioni accessibilità
                if (accessibility.score < 70) {
                    if (parseFloat(accessibility.contrastRatio) < 4.5) {
                        recommendations.push({
                            category: '👁️ Accessibilità',
                            title: 'Migliora il contrasto',
                            description: `Il contrasto attuale (${accessibility.contrastRatio}:1) non rispetta gli standard WCAG. Aumenta la differenza tra testo e sfondo.`,
                            priority: 'alta'
                        });
                    }
                    if (!accessibility.hasAltText) {
                        recommendations.push({
                            category: '👁️ Accessibilità',
                            title: 'Aggiungi testo alternativo',
                            description: 'Inserisci una descrizione dell\'immagine per utenti con disabilità visive.',
                            priority: 'alta'
                        });
                    }
                    if (accessibility.hasTextInImage) {
                        recommendations.push({
                            category: '👁️ Accessibilità',
                            title: 'Evita testo nelle immagini',
                            description: 'Il testo incorporato nelle immagini non è accessibile agli screen reader.',
                            priority: 'media'
                        });
                    }
                }

                // Raccomandazioni economiche
                if (economic.score < 60) {
                    if (!economic.usesDesignSystem) {
                        recommendations.push({
                            category: '💰 Economia',
                            title: 'Usa un design system',
                            description: 'Adopta componenti standardizzati per ridurre i costi di sviluppo e manutenzione.',
                            priority: 'media'
                        });
                    }
                    if (!economic.usesOpenSourceFonts) {
                        recommendations.push({
                            category: '💰 Economia',
                            title: 'Preferisci font open source',
                            description: 'Usa font gratuiti come Google Fonts per evitare costi di licenza.',
                            priority: 'bassa'
                        });
                    }
                }

                if (recommendations.length === 0) {
                    recommendations.push({
                        category: '✨ Ottimo lavoro',
                        title: 'Contenuto ben ottimizzato',
                        description: 'Il tuo contenuto rispetta gli standard di sostenibilità digitale!',
                        priority: 'info'
                    });
                }

                return `
                    <div class="analysis-box">
                        <h3 class="text-2xl font-bold text-[#96E6B3] mb-6">💡 Raccomandazioni</h3>
                        <div class="space-y-4">
                            ${recommendations.map(rec => `
                                <div class="bg-white/5 rounded-lg border-l-4 recommendation-box ${
                                    rec.priority === 'alta' ? 'border-red-500' :
                                    rec.priority === 'media' ? 'border-yellow-500' :
                                    rec.priority === 'bassa' ? 'border-blue-500' :
                                    'border-green-500'
                                }">
                                    <div class="flex items-start gap-4">
                                        <div class="flex-grow">
                                            <div class="flex items-center gap-3 mb-3">
                                                <span class="text-sm text-white/70">${rec.category}</span>
                                                <span class="text-xs px-3 py-1 rounded-full ${
                                                    rec.priority === 'alta' ? 'bg-red-500/20 text-red-300' :
                                                    rec.priority === 'media' ? 'bg-yellow-500/20 text-yellow-300' :
                                                    rec.priority === 'bassa' ? 'bg-blue-500/20 text-blue-300' :
                                                    'bg-green-500/20 text-green-300'
                                                }">
                                                    ${rec.priority === 'info' ? 'Ottimo' : rec.priority.charAt(0).toUpperCase() + rec.priority.slice(1)}
                                                </span>
                                            </div>
                                            <h4 class="font-semibold text-white mb-2">${rec.title}</h4>
                                            <p class="text-white/80 text-sm">${rec.description}</p>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            renderFooter() {
                return `
                    <footer class="text-center mt-12 p-6 border-t border-white/20 no-print">
                        <p class="text-white/60 text-sm">
                            Nova (beta) - Analisi di sostenibilità digitale basata su standard scientifici e linee guida WCAG 2.1
                        </p>
                        <p class="text-white/40 text-xs mt-2">
                            L'analisi non sostituisce una valutazione scientifica o tecnica professionale. Il suo scopo è fornire un'indicazione orientativa e contribuire alla sensibilizzazione verso un approccio più etico, accessibile e sostenibile nella progettazione di contenuti digitali.
                        </p>
                    </footer>
                `;
            }

            renderModals() {
                if (!this.activeModal) return '';

                const modalContent = this.getModalContent(this.activeModal);
                
                return `
                    <div id="modal-backdrop" class="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4">
                        <div class="bg-[#1F3B2C] border border-white/20 rounded-2xl p-6 max-w-lg w-full max-h-[90vh] overflow-y-auto">
                            <div class="flex justify-between items-start mb-4">
                                <h3 class="text-xl font-bold text-[#96E6B3]">${modalContent.title}</h3>
                                <button class="modal-close text-white text-2xl leading-none bg-transparent border-none p-0">&times;</button>
                            </div>
                            <div class="text-white/80 space-y-4">
                                ${modalContent.content}
                            </div>
                        </div>
                    </div>
                `;
            }

            getModalContent(modalId) {
                const modals = {
                    'file-weight': {
                        title: 'Peso del contenuto',
                        content: `
                            <p>Il peso del file influenza direttamente l'impatto ambientale:</p>
                            <ul class="list-disc list-inside space-y-2 mt-3">
                                <li><strong>< 1MB:</strong> Ottimo per il web</li>
                                <li><strong>1-2MB:</strong> Accettabile per la maggior parte degli usi</li>
                                <li><strong>2-5MB:</strong> Pesante, considera la compressione</li>
                                <li><strong>> 5MB:</strong> Molto pesante, impatto ambientale significativo</li>
                            </ul>
                            <p class="mt-3">File più leggeri riducono il consumo di banda, energia e migliorano l'esperienza utente.</p>
                        `
                    },
                    'co2-upload': {
                        title: 'CO₂ per upload',
                        content: `
                            <p>Emissioni di CO₂ generate dal trasferimento del file sui server:</p>
                            <ul class="list-disc list-inside space-y-2 mt-3">
                                <li>Include l'energia per il trasferimento dati</li>
                                <li>Considera l'infrastruttura di rete</li>
                                <li>Calcolo: ~0.5g CO₂ per MB trasferito</li>
                            </ul>
                            <p class="mt-3">Basato su studi del Green Web Foundation e ricerche accademiche.</p>
                        `
                    },
                    'co2-view': {
                        title: 'CO₂ per visualizzazione',
                        content: `
                            <p>Emissioni generate ogni volta che il contenuto viene visualizzato:</p>
                            <ul class="list-disc list-inside space-y-2 mt-3">
                                <li>Include il consumo del dispositivo dell'utente</li>
                                <li>Considera il tipo di schermo (LCD vs OLED)</li>
                                <li>I colori chiari consumano più energia su OLED</li>
                                <li>Calcolo base: ~0.2g CO₂ per MB visualizzato</li>
                            </ul>
                        `
                    },
                    'h2o-upload': {
                        title: 'Acqua per upload',
                        content: `
                            <p>Consumo di acqua per il raffreddamento dei data center durante l'upload:</p>
                            <ul class="list-disc list-inside space-y-2 mt-3">
                                <li>I data center usano acqua per il raffreddamento</li>
                                <li>Rapporto: ~2ml H₂O per 1g CO₂</li>
                                <li>Include l'evaporazione e il ciclo di raffreddamento</li>
                            </ul>
                        `
                    },
                    'h2o-view': {
                        title: 'Acqua per visualizzazione',
                        content: `
                            <p>Consumo di acqua per ogni visualizzazione del contenuto:</p>
                            <ul class="list-disc list-inside space-y-2 mt-3">
                                <li>Include il raffreddamento dei server di distribuzione</li>
                                <li>CDN e cache distribuiti</li>
                                <li>Impatto cumulativo su migliaia di visualizzazioni</li>
                            </ul>
                        `
                    },
                    'contrast': {
                        title: 'Contrasto colore',
                        content: `
                            <p>Il contrasto tra testo e sfondo secondo le linee guida WCAG 2.1:</p>
                            <ul class="list-disc list-inside space-y-2 mt-3">
                                <li><strong>AA:</strong> Minimo 4.5:1 per testo normale</li>
                                <li><strong>AAA:</strong> Minimo 7:1 per testo normale</li>
                                <li><strong>Testo grande:</strong> 3:1 (AA) o 4.5:1 (AAA)</li>
                            </ul>
                            <p class="mt-3">Un buon contrasto migliora la leggibilità per tutti, specialmente per persone con disabilità visive.</p>
                        `
                    },
                    'alt-text': {
                        title: 'Testo alternativo',
                        content: `
                            <p>Il testo alternativo descrive le immagini per gli screen reader:</p>
                            <ul class="list-disc list-inside space-y-2 mt-3">
                                <li>Essenziale per l'accessibilità</li>
                                <li>Deve descrivere il contenuto e il contesto</li>
                                <li>Richiesto dalle linee guida WCAG</li>
                                <li>Migliora anche la SEO</li>
                            </ul>
                        `
                    },
                    'text-in-image': {
                        title: 'Testo in immagini',
                        content: `
                            <p>Il testo incorporato nelle immagini crea barriere di accessibilità:</p>
                            <ul class="list-disc list-inside space-y-2 mt-3">
                                <li>Non leggibile dagli screen reader</li>
                                <li>Non ridimensionabile</li>
                                <li>Problemi di traduzione automatica</li>
                                <li>Preferisci sempre testo HTML + CSS</li>
                            </ul>
                        `
                    },
                    'font-readability': {
                        title: 'Leggibilità font',
                        content: `
                            <p>La leggibilità dei font influenza l'accessibilità:</p>
                            <ul class="list-disc list-inside space-y-2 mt-3">
                                <li>Dimensione minima: 16px per il corpo del testo</li>
                                <li>Evita font troppo decorativi</li>
                                <li>Assicura buona spaziatura tra lettere</li>
                                <li>Considera la dislessia e altre difficoltà di lettura</li>
                            </ul>
                        `
                    },
                    'design-system': {
                        title: 'Design system',
                        content: `
                            <p>Un design system riduce i costi di sviluppo e manutenzione:</p>
                            <ul class="list-disc list-inside space-y-2 mt-3">
                                <li>Componenti riutilizzabili</li>
                                <li>Coerenza visiva</li>
                                <li>Sviluppo più veloce</li>
                                <li>Manutenzione semplificata</li>
                                <li>Esempi: Material Design, Bootstrap</li>
                            </ul>
                        `
                    },
                    'open-fonts': {
                        title: 'Font open source',
                        content: `
                            <p>I font open source eliminano i costi di licenza:</p>
                            <ul class="list-disc list-inside space-y-2 mt-3">
                                <li>Google Fonts: gratuiti e ottimizzati</li>
                                <li>Nessun costo di licenza</li>
                                <li>Ampia scelta di stili</li>
                                <li>Supporto per più lingue</li>
                                <li>Caricamento ottimizzato via CDN</li>
                            </ul>
                        `
                    },
                    'modular-layout': {
                        title: 'Layout modulare',
                        content: `
                            <p>Layout semplici e modulari riducono i costi:</p>
                            <ul class="list-disc list-inside space-y-2 mt-3">
                                <li>Sviluppo più rapido</li>
                                <li>Manutenzione semplificata</li>
                                <li>Responsive design più facile</li>
                                <li>Riutilizzo di componenti</li>
                                <li>Testing più efficiente</li>
                            </ul>
                        `
                    }
                };

                return modals[modalId] || { title: 'Informazione', content: 'Contenuto non disponibile.' };
            }
        }

        // Inizializza l'applicazione
        document.addEventListener('DOMContentLoaded', () => {
            new NovaSustainabilityAnalyzer();
        });
    </script>
</body>
</html>

